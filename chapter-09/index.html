<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Cr√©er une application front-end</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
video {
  display: inline-block;
}
audio:not([controls]) {
  display: none;
  height: 0;
}
script {
  display: none !important;
}
html {
  /* font-family: sans-serif; */
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}
a {
  background: transparent;
}
a:focus {
  outline: thin dotted;
}
a:active,
a:hover {
  outline: 0;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}
mark {
  background: #ff0;
  color: #000;
}
code,
kbd,
pre,
samp {
  font-family: monospace;
  font-size: 1em;
}
pre {
  white-space: pre-wrap;
}
q {
  quotes: '\201C' '\201D' '\2018' '\2019';
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 0;
}
fieldset {
  border: 1px solid silver;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0;
  padding: 0;
}
button,
input,
select,
textarea {
  font-family: inherit;
  font-size: 100%;
  margin: 0;
}
button,
input {
  line-height: normal;
}
button,
select {
  text-transform: none;
}
button,
html input[type='button'],
input[type='reset'],
input[type='submit'] {
  -webkit-appearance: button;
  cursor: pointer;
}
button[disabled],
html input[disabled] {
  cursor: default;
}
input[type='checkbox'],
input[type='radio'] {
  box-sizing: border-box;
  padding: 0;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
textarea {
  overflow: auto;
  vertical-align: top;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}
*,
*::before,
*::after {
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}
html,
body {
  font-size: 18px;
}
body {
  background: #fff;
  color: rgba(0, 0, 0, 0.8);
  padding: 0;
  margin: 0;
  font-family: Georgia, "Times New Roman", Times, serif;
  font-weight: 400;
  font-style: normal;
  line-height: 1.5;
  position: relative;
  cursor: auto;
  tab-size: 4;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
}
a:hover {
  cursor: pointer;
}
img,
object,
embed {
  max-width: 100%;
  height: auto;
}
object,
embed {
  height: 100%;
}
img {
  -ms-interpolation-mode: bicubic;
}
.left {
  float: left !important;
}
.right {
  float: right !important;
}
.text-left {
  text-align: left !important;
}
.text-right {
  text-align: right !important;
}
.text-center {
  text-align: center !important;
}
.text-justify {
  text-align: justify !important;
}
.hide {
  display: none;
}
img,
object,
svg {
  display: inline-block;
  vertical-align: middle;
}
textarea {
  height: auto;
  min-height: 50px;
}
select {
  width: 100%;
}
.center {
  margin-left: auto;
  margin-right: auto;
}
.stretch {
  width: 100%;
}
p.lead,
.paragraph.lead > p,
#preamble > .sectionbody > .paragraph:first-of-type p {
  font-size: 1.21875em;
  line-height: 1.6;
}
.subheader,
.admonitionblock td.content > .title,
.audioblock > .title,
.exampleblock > .title,
.imageblock > .title,
.listingblock > .title,
.literalblock > .title,
.stemblock > .title,
.openblock > .title,
.paragraph > .title,
.quoteblock > .title,
table.tableblock > .title,
.verseblock > .title,
.videoblock > .title,
.dlist > .title,
.olist > .title,
.ulist > .title,
.qlist > .title,
.hdlist > .title {
  line-height: 1.45;
  color: #7a2518;
  font-weight: 400;
  margin-top: 0;
  margin-bottom: 0.25em;
}
div,
dl,
dt,
dd,
ul,
ol,
li,
h1,
h2,
h3,
#toctitle,
.sidebarblock > .content > .title,
h4,
h5,
h6,
pre,
form,
p,
blockquote,
th,
td {
  margin: 0;
  padding: 0;
  direction: ltr;
}
a {
  color: #2156a5;
  text-decoration: underline;
  line-height: inherit;
}
a:hover,
a:focus {
  color: #1d4b8f;
}
a img {
  border: none;
}
p {
  font-family: inherit;
  font-weight: 400;
  font-size: 1em;
  line-height: 1.6;
  margin-bottom: 1.25em;
  text-rendering: optimizeLegibility;
}
p aside {
  font-size: 0.875em;
  line-height: 1.35;
  font-style: italic;
}
h1,
h2,
h3,
#toctitle,
.sidebarblock > .content > .title,
h4,
h5,
h6 {
  font-family: 'Open Sans', 'DejaVu Sans', sans-serif;
  font-weight: 300;
  font-style: normal;
  color: #ba3925;
  text-rendering: optimizeLegibility;
  margin-top: 1em;
  margin-bottom: 0.5em;
  line-height: 1.0125em;
}
h1 small,
h2 small,
h3 small,
#toctitle small,
.sidebarblock > .content > .title small,
h4 small,
h5 small,
h6 small {
  font-size: 60%;
  color: #e99b8f;
  line-height: 0;
}
h1 {
  font-size: 2.125em;
}
h2 {
  font-size: 1.6875em;
}
h3,
#toctitle,
.sidebarblock > .content > .title {
  font-size: 1.375em;
}
h4,
h5 {
  font-size: 1.125em;
}
h6 {
  font-size: 1em;
}
hr {
  border: solid #ddddd8;
  border-width: 1px 0 0;
  clear: both;
  margin: 1.25em 0 1.1875em;
  height: 0;
}
em,
i {
  font-style: italic;
  line-height: inherit;
}
strong,
b {
  font-weight: bold;
  line-height: inherit;
}
small {
  font-size: 60%;
  line-height: inherit;
}
code {
  font-family: 'Droid Sans Mono', 'DejaVu Sans Mono', monospace;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.9);
}
ul,
ol,
dl {
  font-size: 1em;
  line-height: 1.6;
  margin-bottom: 1.25em;
  list-style-position: outside;
  font-family: inherit;
}
ul,
ol {
  margin-left: 1.5em;
}
ul li ul,
ul li ol {
  margin-left: 1.25em;
  margin-bottom: 0;
  font-size: 1em;
}
ul.square li ul,
ul.circle li ul,
ul.disc li ul {
  list-style: inherit;
}
ul.square {
  list-style-type: square;
}
ul.circle {
  list-style-type: circle;
}
ul.disc {
  list-style-type: disc;
}
ol li ul,
ol li ol {
  margin-left: 1.25em;
  margin-bottom: 0;
}
dl dt {
  margin-bottom: 0.3125em;
  font-weight: bold;
}
dl dd {
  margin-bottom: 1.25em;
}
abbr,
acronym {
  text-transform: uppercase;
  font-size: 90%;
  color: rgba(0, 0, 0, 0.8);
  border-bottom: 1px dotted #ddd;
  cursor: help;
}
abbr {
  text-transform: none;
}
blockquote {
  margin: 0 0 1.25em;
  padding: 0.5625em 1.25em 0 1.1875em;
  border-left: 1px solid #ddd;
}
blockquote cite {
  display: block;
  font-size: 0.9375em;
  color: rgba(0, 0, 0, 0.6);
}
blockquote cite::before {
  content: '\2014 \0020';
}
blockquote cite a,
blockquote cite a:visited {
  color: rgba(0, 0, 0, 0.6);
}
blockquote,
blockquote p {
  line-height: 1.6;
  color: rgba(0, 0, 0, 0.85);
}
@media only screen and (min-width: 768px) {
  h1,
  h2,
  h3,
  #toctitle,
  .sidebarblock > .content > .title,
  h4,
  h5,
  h6 {
    line-height: 1.2;
  }
  h1 {
    font-size: 2.75em;
  }
  h2 {
    font-size: 2.3125em;
  }
  h3,
  #toctitle,
  .sidebarblock > .content > .title {
    font-size: 1.6875em;
  }
  h4 {
    font-size: 1.4375em;
  }
}
table {
  background: #fff;
  margin-bottom: 1.25em;
  border: solid 1px #dedede;
}
table thead,
table tfoot {
  background: #f7f8f7;
}
table thead tr th,
table thead tr td,
table tfoot tr th,
table tfoot tr td {
  padding: 0.5em 0.625em 0.625em;
  font-size: inherit;
  color: rgba(0, 0, 0, 0.8);
  text-align: left;
}
table tr th,
table tr td {
  padding: 0.5625em 0.625em;
  font-size: inherit;
  color: rgba(0, 0, 0, 0.8);
}
table tr.even,
table tr.alt,
table tr:nth-of-type(even) {
  background: #f8f8f7;
}
table thead tr th,
table tfoot tr th,
table tbody tr td,
table tr td,
table tfoot tr td {
  display: table-cell;
  line-height: 1.6;
}
h1,
h2,
h3,
#toctitle,
.sidebarblock > .content > .title,
h4,
h5,
h6 {
  line-height: 1.2;
  word-spacing: -0.05em;
}
h1 strong,
h2 strong,
h3 strong,
#toctitle strong,
.sidebarblock > .content > .title strong,
h4 strong,
h5 strong,
h6 strong {
  font-weight: 400;
}
.clearfix::before,
.clearfix::after,
.float-group::before,
.float-group::after {
  content: ' ';
  display: table;
}
.clearfix::after,
.float-group::after {
  clear: both;
}
*:not(pre) > code {
  font-size: 0.9375em;
  font-style: normal !important;
  letter-spacing: 0;
  padding: 0.1em 0.5ex;
  word-spacing: -0.15em;
  background-color: #f7f7f8;
  -webkit-border-radius: 4px;
  border-radius: 4px;
  line-height: 1.45;
  text-rendering: optimizeSpeed;
  word-wrap: break-word;
}
*:not(pre) > code.nobreak {
  word-wrap: normal;
}
*:not(pre) > code.nowrap {
  white-space: nowrap;
}
pre,
pre > code {
  line-height: 1.45;
  color: rgba(0, 0, 0, 0.9);
  font-family: 'Droid Sans Mono', 'DejaVu Sans Mono', monospace;
  font-weight: 400;
  text-rendering: optimizeSpeed;
}
em em {
  font-style: normal;
}
strong strong {
  font-weight: 400;
}
.keyseq {
  color: rgba(51, 51, 51, 0.8);
}
kbd {
  font-family: 'Droid Sans Mono', 'DejaVu Sans Mono', monospace;
  display: inline-block;
  color: rgba(0, 0, 0, 0.8);
  font-size: 0.65em;
  line-height: 1.45;
  background-color: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em #fff inset;
  margin: 0 0.15em;
  padding: 0.2em 0.5em;
  vertical-align: middle;
  position: relative;
  top: -0.1em;
  white-space: nowrap;
}
.keyseq kbd:first-child {
  margin-left: 0;
}
.keyseq kbd:last-child {
  margin-right: 0;
}
.menuseq,
.menuref {
  color: #000;
}
.menuseq b:not(.caret),
.menuref {
  font-weight: inherit;
}
.menuseq {
  word-spacing: -0.02em;
}
.menuseq b.caret {
  font-size: 1.25em;
  line-height: 0.8;
}
.menuseq i.caret {
  font-weight: bold;
  text-align: center;
  width: 0.45em;
}
b.button::before,
b.button::after {
  position: relative;
  top: -1px;
  font-weight: 400;
}
b.button::before {
  content: '[';
  padding: 0 3px 0 2px;
}
b.button::after {
  content: ']';
  padding: 0 2px 0 3px;
}
p a > code:hover {
  color: rgba(0, 0, 0, 0.9);
}
#header,
#content,
#footnotes,
#footer {
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  margin-top: 0;
  margin-bottom: 0;
  max-width: 62.5em;
  *zoom: 1;
  position: relative;
  padding-left: 0.9375em;
  padding-right: 0.9375em;
}
#header::before,
#header::after,
#content::before,
#content::after,
#footnotes::before,
#footnotes::after,
#footer::before,
#footer::after {
  content: ' ';
  display: table;
}
#header::after,
#content::after,
#footnotes::after,
#footer::after {
  clear: both;
}
#content {
  margin-top: 1.25em;
}
#content::before {
  content: none;
}
#header > h1:first-child {
  color: rgba(0, 0, 0, 0.85);
  margin-top: 2.25rem;
  margin-bottom: 0;
}
#header > h1:first-child + #toc {
  margin-top: 8px;
  border-top: 1px solid #ddddd8;
}
#header > h1:only-child,
body.toc2 #header > h1:nth-last-child(2) {
  border-bottom: 1px solid #ddddd8;
  padding-bottom: 8px;
}
#header .details {
  border-bottom: 1px solid #ddddd8;
  line-height: 1.45;
  padding-top: 0.25em;
  padding-bottom: 0.25em;
  padding-left: 0.25em;
  color: rgba(0, 0, 0, 0.6);
  display: -ms-flexbox;
  display: -webkit-flex;
  display: flex;
  -ms-flex-flow: row wrap;
  -webkit-flex-flow: row wrap;
  flex-flow: row wrap;
}
#header .details span:first-child {
  margin-left: -0.125em;
}
#header .details span.email a {
  color: rgba(0, 0, 0, 0.85);
}
#header .details br {
  display: none;
}
#header .details br + span::before {
  content: '\00a0\2013\00a0';
}
#header .details br + span.author::before {
  content: '\00a0\22c5\00a0';
  color: rgba(0, 0, 0, 0.85);
}
#header .details br + span#revremark::before {
  content: '\00a0|\00a0';
}
#header #revnumber {
  text-transform: capitalize;
}
#header #revnumber::after {
  content: '\00a0';
}
#content > h1:first-child:not([class]) {
  color: rgba(0, 0, 0, 0.85);
  border-bottom: 1px solid #ddddd8;
  padding-bottom: 8px;
  margin-top: 0;
  padding-top: 1rem;
  margin-bottom: 1.25rem;
}
#toc {
  border-bottom: 1px solid #efefed;
  padding-bottom: 0.5em;
}
#toc > ul {
  margin-left: 0.125em;
}
#toc ul.sectlevel0 > li > a {
  font-style: italic;
}
#toc ul.sectlevel0 ul.sectlevel1 {
  margin: 0.5em 0;
}
#toc ul {
  font-family: Gill Sans, Gill Sans MT, Calibri, sans-serif;
  list-style-type: none;
}
#toc li {
  line-height: 1.3334;
  margin-top: 0.3334em;
}
#toc a {
  text-decoration: none;
  white-space: normal;
}
#toc a:active {
  text-decoration: underline;
}
#toctitle {
  color: #7a2518;
  font-size: 1.2em;
}
@media only screen and (min-width: 768px) {
  #toctitle {
    font-size: 1.375em;
  }
  body.toc2 {
    padding-left: 16em;
    padding-right: 1em;
  }
  #toc.toc2 {
    margin-top: 0 !important;
    background-color: #f8f8f7;
    position: fixed;
    width: 15em;
    left: 0;
    top: 0;
    border-right: 1px solid #efefed;
    border-top-width: 0 !important;
    border-bottom-width: 0 !important;
    z-index: 1000;
    padding: 1.25em 1em;
    height: 100%;
    overflow: auto;
  }
  #toc.toc2 #toctitle {
    margin-top: 0;
    margin-bottom: 0.8rem;
    font-size: 1.2em;
  }
  #toc.toc2 > ul {
    font-size: 0.85em;
    margin-bottom: 0;
  }
  #toc.toc2 ul ul {
    margin-left: 0;
    padding-left: 1em;
  }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
    padding-left: 0;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
  body.toc2.toc-right {
    padding-left: 0;
    padding-right: 15em;
  }
  body.toc2.toc-right #toc.toc2 {
    border-right-width: 0;
    border-left: 1px solid #efefed;
    left: auto;
    right: 0;
  }
}
@media only screen and (min-width: 1280px) {
  body.toc2 {
    padding-left: 27%;
    padding-left: 27vw;
    padding-right: 2%;
    padding-right: 2vw;
  }
  #toc.toc2 {
    width: 25%;
    width: 25vw;
  }
  #toc.toc2 #toctitle {
    font-size: 1.375em;
  }
  #toc.toc2 ul ul {
    padding-left: 1.25em;
  }
  body.toc2.toc-right {
    padding-left: 0;
    padding-right: 20em;
  }
}
#content #toc {
  border-style: solid;
  border-width: 1px;
  border-color: #e0e0dc;
  margin-bottom: 1.25em;
  padding: 1.25em;
  background: #f8f8f7;
  -webkit-border-radius: 4px;
  border-radius: 4px;
}
#content #toc > :first-child {
  margin-top: 0;
}
#content #toc > :last-child {
  margin-bottom: 0;
}
#footer {
  max-width: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  padding: 1.25em;
}
#footer-text {
  color: rgba(255, 255, 255, 0.8);
  line-height: 1.44;
}
#content {
  margin-bottom: 0.625em;
}
.sect1 {
  padding-bottom: 0.625em;
}
@media only screen and (min-width: 768px) {
  #content {
    margin-bottom: 1.25em;
  }
  .sect1 {
    padding-bottom: 1.25em;
  }
}
.sect1:last-child {
  padding-bottom: 0;
}
.sect1 + .sect1 {
  border-top: 1px solid #efefed;
}
#content h1 > a.anchor,
h2 > a.anchor,
h3 > a.anchor,
#toctitle > a.anchor,
.sidebarblock > .content > .title > a.anchor,
h4 > a.anchor,
h5 > a.anchor,
h6 > a.anchor {
  position: absolute;
  z-index: 1001;
  width: 1.5ex;
  margin-left: -1.5ex;
  display: block;
  text-decoration: none !important;
  visibility: hidden;
  text-align: center;
  font-weight: 400;
}
#content h1 > a.anchor::before,
h2 > a.anchor::before,
h3 > a.anchor::before,
#toctitle > a.anchor::before,
.sidebarblock > .content > .title > a.anchor::before,
h4 > a.anchor::before,
h5 > a.anchor::before,
h6 > a.anchor::before {
  content: '\00A7';
  font-size: 0.85em;
  display: block;
  padding-top: 0.1em;
}
#content h1:hover > a.anchor,
#content h1 > a.anchor:hover,
h2:hover > a.anchor,
h2 > a.anchor:hover,
h3:hover > a.anchor,
#toctitle:hover > a.anchor,
.sidebarblock > .content > .title:hover > a.anchor,
h3 > a.anchor:hover,
#toctitle > a.anchor:hover,
.sidebarblock > .content > .title > a.anchor:hover,
h4:hover > a.anchor,
h4 > a.anchor:hover,
h5:hover > a.anchor,
h5 > a.anchor:hover,
h6:hover > a.anchor,
h6 > a.anchor:hover {
  visibility: visible;
}
#content h1 > a.link,
h2 > a.link,
h3 > a.link,
#toctitle > a.link,
.sidebarblock > .content > .title > a.link,
h4 > a.link,
h5 > a.link,
h6 > a.link {
  color: #ba3925;
  text-decoration: none;
}
#content h1 > a.link:hover,
h2 > a.link:hover,
h3 > a.link:hover,
#toctitle > a.link:hover,
.sidebarblock > .content > .title > a.link:hover,
h4 > a.link:hover,
h5 > a.link:hover,
h6 > a.link:hover {
  color: #a53221;
}
.audioblock,
.imageblock,
.literalblock,
.listingblock,
.stemblock,
.videoblock {
  margin-bottom: 1.25em;
}
.admonitionblock td.content > .title,
.audioblock > .title,
.exampleblock > .title,
.imageblock > .title,
.listingblock > .title,
.literalblock > .title,
.stemblock > .title,
.openblock > .title,
.paragraph > .title,
.quoteblock > .title,
table.tableblock > .title,
.verseblock > .title,
.videoblock > .title,
.dlist > .title,
.olist > .title,
.ulist > .title,
.qlist > .title,
.hdlist > .title {
  text-rendering: optimizeLegibility;
  text-align: left;
  font-family: Gill Sans, Gill Sans MT, Calibri, sans-serif;
  font-size: 1rem;
  font-style: italic;
  font-weight: 300;
}
table.tableblock > caption.title {
  white-space: nowrap;
  overflow: visible;
  max-width: 0;
}
.paragraph.lead > p,
#preamble > .sectionbody > .paragraph:first-of-type p {
  color: rgba(0, 0, 0, 0.85);
}
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p {
  font-size: inherit;
}
.admonitionblock > table {
  border-collapse: separate;
  border: 0;
  background: none;
  width: 100%;
}
.admonitionblock > table td.icon {
  text-align: center;
  width: 80px;
}
.admonitionblock > table td.icon img {
  max-width: none;
}
.admonitionblock > table td.icon .title {
  font-weight: bold;
  /* font-family: 'Open Sans', 'DejaVu Sans', sans-serif; */
  text-transform: uppercase;
}
.admonitionblock > table td.content {
  padding-left: 1.125em;
  padding-right: 1.25em;
  border-left: 1px solid #ddddd8;
  color: rgba(0, 0, 0, 0.6);
}
.admonitionblock > table td.content > :last-child > :last-child {
  margin-bottom: 0;
}
.exampleblock > .content {
  border-style: solid;
  border-width: 1px;
  border-color: #e6e6e6;
  margin-bottom: 1.25em;
  padding: 1.25em;
  background: #fff;
  -webkit-border-radius: 4px;
  border-radius: 4px;
}
.exampleblock > .content > :first-child {
  margin-top: 0;
}
.exampleblock > .content > :last-child {
  margin-bottom: 0;
}
.sidebarblock {
  border-style: solid;
  border-width: 1px;
  border-color: #e0e0dc;
  margin-bottom: 1.25em;
  padding: 1.25em;
  background: #f8f8f7;
  -webkit-border-radius: 4px;
  border-radius: 4px;
}
.sidebarblock > :first-child {
  margin-top: 0;
}
.sidebarblock > :last-child {
  margin-bottom: 0;
}
.sidebarblock > .content > .title {
  color: #7a2518;
  margin-top: 0;
  text-align: center;
}
.exampleblock > .content > :last-child > :last-child,
.exampleblock > .content .olist > ol > li:last-child > :last-child,
.exampleblock > .content .ulist > ul > li:last-child > :last-child,
.exampleblock > .content .qlist > ol > li:last-child > :last-child,
.sidebarblock > .content > :last-child > :last-child,
.sidebarblock > .content .olist > ol > li:last-child > :last-child,
.sidebarblock > .content .ulist > ul > li:last-child > :last-child,
.sidebarblock > .content .qlist > ol > li:last-child > :last-child {
  margin-bottom: 0;
}
.literalblock pre,
.listingblock pre:not(.highlight),
.listingblock pre[class='highlight'],
.listingblock pre[class^='highlight '],
.listingblock pre.CodeRay,
.listingblock pre.prettyprint {
  background: #f7f7f8;
}
.sidebarblock .literalblock pre,
.sidebarblock .listingblock pre:not(.highlight),
.sidebarblock .listingblock pre[class='highlight'],
.sidebarblock .listingblock pre[class^='highlight '],
.sidebarblock .listingblock pre.CodeRay,
.sidebarblock .listingblock pre.prettyprint {
  background: #f2f1f1;
}
.literalblock pre,
.literalblock pre[class],
.listingblock pre,
.listingblock pre[class] {
  -webkit-border-radius: 4px;
  border-radius: 4px;
  word-wrap: break-word;
  padding: 1em;
  font-size: 0.8125em;
}
.literalblock pre.nowrap,
.literalblock pre[class].nowrap,
.listingblock pre.nowrap,
.listingblock pre[class].nowrap {
  overflow-x: auto;
  white-space: pre;
  word-wrap: normal;
}
@media only screen and (min-width: 768px) {
  .literalblock pre,
  .literalblock pre[class],
  .listingblock pre,
  .listingblock pre[class] {
    font-size: 0.90625em;
  }
}
@media only screen and (min-width: 1280px) {
  .literalblock pre,
  .literalblock pre[class],
  .listingblock pre,
  .listingblock pre[class] {
    font-size: 1em;
  }
}
.literalblock.output pre {
  color: #f7f7f8;
  background-color: rgba(0, 0, 0, 0.9);
}
.listingblock pre.highlightjs {
  padding: 0;
}
.listingblock pre.highlightjs > code {
  padding: 1em;
  -webkit-border-radius: 4px;
  border-radius: 4px;
}
.listingblock pre.prettyprint {
  border-width: 0;
}
.listingblock > .content {
  position: relative;
}
.listingblock code[data-lang]::before {
  display: none;
  content: attr(data-lang);
  position: absolute;
  font-size: 0.75em;
  top: 0.425rem;
  right: 0.5rem;
  line-height: 1;
  text-transform: uppercase;
  color: #999;
}
.listingblock:hover code[data-lang]::before {
  display: block;
}
.listingblock.terminal pre .command::before {
  content: attr(data-prompt);
  padding-right: 0.5em;
  color: #999;
}
.listingblock.terminal pre .command:not([data-prompt])::before {
  content: '$';
}
table.pyhltable {
  border-collapse: separate;
  border: 0;
  margin-bottom: 0;
  background: none;
}
table.pyhltable td {
  vertical-align: top;
  padding-top: 0;
  padding-bottom: 0;
  line-height: 1.45;
}
table.pyhltable td.code {
  padding-left: 0.75em;
  padding-right: 0;
}
pre.pygments .lineno,
table.pyhltable td:not(.code) {
  color: #999;
  padding-left: 0;
  padding-right: 0.5em;
  border-right: 1px solid #ddddd8;
}
pre.pygments .lineno {
  display: inline-block;
  margin-right: 0.25em;
}
table.pyhltable .linenodiv {
  background: none !important;
  padding-right: 0 !important;
}
.quoteblock {
  margin: 0 1em 1.25em 1.5em;
  display: table;
}
.quoteblock > .title {
  margin-left: -1.5em;
  margin-bottom: 0.75em;
}
.quoteblock blockquote,
.quoteblock blockquote p {
  color: rgba(0, 0, 0, 0.85);
  font-size: 1.15rem;
  line-height: 1.75;
  word-spacing: 0.1em;
  letter-spacing: 0;
  font-style: italic;
  text-align: justify;
}
.quoteblock blockquote {
  margin: 0;
  padding: 0;
  border: 0;
}
.quoteblock blockquote::before {
  content: '\201c';
  float: left;
  font-size: 2.75em;
  font-weight: bold;
  line-height: 0.6em;
  margin-left: -0.6em;
  color: #7a2518;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.quoteblock blockquote > .paragraph:last-child p {
  margin-bottom: 0;
}
.quoteblock .attribution {
  margin-top: 0.5em;
  margin-right: 0.5ex;
  text-align: right;
}
.quoteblock .quoteblock {
  margin-left: 0;
  margin-right: 0;
  padding: 0.5em 0;
  border-left: 3px solid rgba(0, 0, 0, 0.6);
}
.quoteblock .quoteblock blockquote {
  padding: 0 0 0 0.75em;
}
.quoteblock .quoteblock blockquote::before {
  display: none;
}
.verseblock {
  margin: 0 1em 1.25em 1em;
}
.verseblock pre {
  /* font-family: 'Open Sans', 'DejaVu Sans', sans; */
  font-size: 1.15rem;
  color: rgba(0, 0, 0, 0.85);
  font-weight: 300;
  text-rendering: optimizeLegibility;
}
.verseblock pre strong {
  font-weight: 400;
}
.verseblock .attribution {
  margin-top: 1.25rem;
  margin-left: 0.5ex;
}
.quoteblock .attribution,
.verseblock .attribution {
  font-size: 0.9375em;
  line-height: 1.45;
  font-style: italic;
}
.quoteblock .attribution br,
.verseblock .attribution br {
  display: none;
}
.quoteblock .attribution cite,
.verseblock .attribution cite {
  display: block;
  letter-spacing: -0.025em;
  color: rgba(0, 0, 0, 0.6);
}
.quoteblock.abstract {
  margin: 0 0 1.25em 0;
  display: block;
}
.quoteblock.abstract blockquote,
.quoteblock.abstract blockquote p {
  text-align: left;
  word-spacing: 0;
}
.quoteblock.abstract blockquote::before,
.quoteblock.abstract blockquote p:first-of-type::before {
  display: none;
}
table.tableblock {
  max-width: 100%;
  border-collapse: separate;
}
p.tableblock:last-child {
  margin-bottom: 0;
}
td.tableblock > .content {
  margin-bottom: -1.25em;
}
table.tableblock,
th.tableblock,
td.tableblock {
  border: 0 solid #dedede;
}
table.grid-all > thead > tr > .tableblock,
table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0;
}
table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0;
}
table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0;
}
table.grid-rows > thead > tr > .tableblock,
table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px 0;
}
table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0 0;
}
table.grid-all > * > tr > .tableblock:last-child,
table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0;
}
table.grid-all > tbody > tr:last-child > .tableblock,
table.grid-all > thead:last-child > tr > .tableblock,
table.grid-rows > tbody > tr:last-child > .tableblock,
table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0;
}
table.frame-all {
  border-width: 1px;
}
table.frame-sides {
  border-width: 0 1px;
}
table.frame-topbot {
  border-width: 1px 0;
}
table.stripe-all tr,
table.stripe-odd tr:nth-of-type(odd) {
  background: #f8f8f7;
}
table.stripe-none tr,
table.stripe-odd tr:nth-of-type(even) {
  background: none;
}
th.halign-left,
td.halign-left {
  text-align: left;
}
th.halign-right,
td.halign-right {
  text-align: right;
}
th.halign-center,
td.halign-center {
  text-align: center;
}
th.valign-top,
td.valign-top {
  vertical-align: top;
}
th.valign-bottom,
td.valign-bottom {
  vertical-align: bottom;
}
th.valign-middle,
td.valign-middle {
  vertical-align: middle;
}
table thead th,
table tfoot th {
  font-weight: bold;
}
tbody tr th {
  display: table-cell;
  line-height: 1.6;
  background: #f7f8f7;
}
tbody tr th,
tbody tr th p,
tfoot tr th,
tfoot tr th p {
  color: rgba(0, 0, 0, 0.8);
  font-weight: bold;
}
p.tableblock > code:only-child {
  background: none;
  padding: 0;
}
p.tableblock {
  font-size: 1em;
}
td > div.verse {
  white-space: pre;
}
ol {
  margin-left: 1.75em;
}
ul li ol {
  margin-left: 1.5em;
}
dl dd {
  margin-left: 1.125em;
}
dl dd:last-child,
dl dd:last-child > :last-child {
  margin-bottom: 0;
}
ol > li p,
ul > li p,
ul dd,
ol dd,
.olist .olist,
.ulist .ulist,
.ulist .olist,
.olist .ulist {
  margin-bottom: 0.625em;
}
ul.checklist,
ul.none,
ol.none,
ul.no-bullet,
ol.no-bullet,
ol.unnumbered,
ul.unstyled,
ol.unstyled {
  list-style-type: none;
}
ul.no-bullet,
ol.no-bullet,
ol.unnumbered {
  margin-left: 0.625em;
}
ul.unstyled,
ol.unstyled {
  margin-left: 0;
}
ul.checklist {
  margin-left: 0.625em;
}
ul.checklist li > p:first-child > .fa-square-o:first-child,
ul.checklist li > p:first-child > .fa-check-square-o:first-child {
  width: 1.25em;
  font-size: 0.8em;
  position: relative;
  bottom: 0.125em;
}
ul.checklist li > p:first-child > input[type='checkbox']:first-child {
  margin-right: 0.25em;
}
ul.inline {
  display: -ms-flexbox;
  display: -webkit-box;
  display: flex;
  -ms-flex-flow: row wrap;
  -webkit-flex-flow: row wrap;
  flex-flow: row wrap;
  list-style: none;
  margin: 0 0 0.625em -1.25em;
}
ul.inline > li {
  margin-left: 1.25em;
}
.unstyled dl dt {
  font-weight: 400;
  font-style: normal;
}
ol.arabic {
  list-style-type: decimal;
}
ol.decimal {
  list-style-type: decimal-leading-zero;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}
ol.lowergreek {
  list-style-type: lower-greek;
}
.hdlist > table,
.colist > table {
  border: 0;
  background: none;
}
.hdlist > table > tbody > tr,
.colist > table > tbody > tr {
  background: none;
}
td.hdlist1,
td.hdlist2 {
  vertical-align: top;
  padding: 0 0.625em;
}
td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em;
}
.literalblock + .colist,
.listingblock + .colist {
  margin-top: -0.5em;
}
.colist td:not([class]):first-child {
  padding: 0.4em 0.75em 0 0.75em;
  line-height: 1;
  vertical-align: top;
}
.colist td:not([class]):first-child img {
  max-width: none;
}
.colist td:not([class]):last-child {
  padding: 0.25em 0;
}
.thumb,
.th {
  line-height: 0;
  display: inline-block;
  border: solid 4px #fff;
  -webkit-box-shadow: 0 0 0 1px #ddd;
  box-shadow: 0 0 0 1px #ddd;
}
.imageblock.left,
.imageblock[style*='float: left'] {
  margin: 0.25em 0.625em 1.25em 0;
}
.imageblock.right,
.imageblock[style*='float: right'] {
  margin: 0.25em 0 1.25em 0.625em;
}
.imageblock > .title {
  margin-bottom: 0;
}
.imageblock.thumb,
.imageblock.th {
  border-width: 6px;
}
.imageblock.thumb > .title,
.imageblock.th > .title {
  padding: 0 0.125em;
}
.image.left,
.image.right {
  margin-top: 0.25em;
  margin-bottom: 0.25em;
  display: inline-block;
  line-height: 0;
}
.image.left {
  margin-right: 0.625em;
}
.image.right {
  margin-left: 0.625em;
}
a.image {
  text-decoration: none;
  display: inline-block;
}
a.image object {
  pointer-events: none;
}
sup.footnote,
sup.footnoteref {
  font-size: 0.875em;
  position: static;
  vertical-align: super;
}
sup.footnote a,
sup.footnoteref a {
  text-decoration: none;
}
sup.footnote a:active,
sup.footnoteref a:active {
  text-decoration: underline;
}
#footnotes {
  padding-top: 0.75em;
  padding-bottom: 0.75em;
  margin-bottom: 0.625em;
}
#footnotes hr {
  width: 20%;
  min-width: 6.25em;
  margin: -0.25em 0 0.75em 0;
  border-width: 1px 0 0 0;
}
#footnotes .footnote {
  padding: 0 0.375em 0 0.225em;
  line-height: 1.3334;
  font-size: 0.875em;
  margin-left: 1.2em;
  margin-bottom: 0.2em;
}
#footnotes .footnote a:first-of-type {
  font-weight: bold;
  text-decoration: none;
  margin-left: -1.05em;
}
#footnotes .footnote:last-of-type {
  margin-bottom: 0;
}
#content #footnotes {
  margin-top: -0.625em;
  margin-bottom: 0;
  padding: 0.75em 0;
}
.gist .file-data > table {
  border: 0;
  background: #fff;
  width: 100%;
  margin-bottom: 0;
}
.gist .file-data > table td.line-data {
  width: 99%;
}
div.unbreakable {
  page-break-inside: avoid;
}
.big {
  font-size: larger;
}
.small {
  font-size: smaller;
}
.underline {
  text-decoration: underline;
}
.overline {
  text-decoration: overline;
}
.line-through {
  text-decoration: line-through;
}
.aqua {
  color: #00bfbf;
}
.aqua-background {
  background-color: #00fafa;
}
.black {
  color: #000;
}
.black-background {
  background-color: #000;
}
.blue {
  color: #0000bf;
}
.blue-background {
  background-color: #0000fa;
}
.fuchsia {
  color: #bf00bf;
}
.fuchsia-background {
  background-color: #fa00fa;
}
.gray {
  color: #606060;
}
.gray-background {
  background-color: #7d7d7d;
}
.green {
  color: #006000;
}
.green-background {
  background-color: #007d00;
}
.lime {
  color: #00bf00;
}
.lime-background {
  background-color: #00fa00;
}
.maroon {
  color: #600000;
}
.maroon-background {
  background-color: #7d0000;
}
.navy {
  color: #000060;
}
.navy-background {
  background-color: #00007d;
}
.olive {
  color: #606000;
}
.olive-background {
  background-color: #7d7d00;
}
.purple {
  color: #600060;
}
.purple-background {
  background-color: #7d007d;
}
.red {
  color: #bf0000;
}
.red-background {
  background-color: #fa0000;
}
.silver {
  color: #909090;
}
.silver-background {
  background-color: #bcbcbc;
}
.teal {
  color: #006060;
}
.teal-background {
  background-color: #007d7d;
}
.white {
  color: #bfbfbf;
}
.white-background {
  background-color: #fafafa;
}
.yellow {
  color: #bfbf00;
}
.yellow-background {
  background-color: #fafa00;
}
span.icon > .fa {
  cursor: default;
}
a span.icon > .fa {
  cursor: inherit;
}
.admonitionblock td.icon [class^='fa icon-'] {
  font-size: 2.5em;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  cursor: default;
}
.admonitionblock td.icon .icon-note::before {
  content: '\f05a';
  color: #19407c;
}
.admonitionblock td.icon .icon-tip::before {
  content: '\f0eb';
  text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8);
  color: #111;
}
.admonitionblock td.icon .icon-warning::before {
  content: '\f071';
  color: #bf6900;
}
.admonitionblock td.icon .icon-caution::before {
  content: '\f06d';
  color: #bf3400;
}
.admonitionblock td.icon .icon-important::before {
  content: '\f06a';
  color: #bf0000;
}
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background-color: rgba(0, 0, 0, 0.8);
  -webkit-border-radius: 100px;
  border-radius: 100px;
  text-align: center;
  font-size: 0.75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  /* font-family: 'Open Sans', 'DejaVu Sans', sans-serif; */
  font-style: normal;
  font-weight: bold;
}
.conum[data-value] * {
  color: #fff !important;
}
.conum[data-value] + b {
  display: none;
}
.conum[data-value]::after {
  content: attr(data-value);
}
pre .conum[data-value] {
  position: relative;
  top: -0.125em;
}
b.conum * {
  color: inherit !important;
  font-style: normal;
}
.conum:not([data-value]):empty {
  display: none;
}
dt,
th.tableblock,
td.content,
div.footnote {
  text-rendering: optimizeLegibility;
}
h1,
h2,
p,
td.content,
span.alt {
  letter-spacing: -0.01em;
}
p strong,
td.content strong,
div.footnote strong {
  letter-spacing: -0.005em;
}
p,
blockquote,
dt,
td.content,
span.alt {
  font-size: 1.0625rem;
}
p {
  margin-bottom: 1.25rem;
}
.sidebarblock p,
.sidebarblock dt,
.sidebarblock td.content,
p.tableblock {
  font-size: 1em;
}
.exampleblock > .content {
  background-color: #fffef7;
  border-color: #e0e0dc;
  -webkit-box-shadow: 0 1px 4px #e0e0dc;
  box-shadow: 0 1px 4px #e0e0dc;
}
.print-only {
  display: none !important;
}
@page {
  margin: 1.25cm 0.75cm;
}
@media print {
  * {
    -webkit-box-shadow: none !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
  html {
    font-size: 80%;
  }
  a {
    color: inherit !important;
    text-decoration: underline !important;
  }
  a.bare,
  a[href^='#'],
  a[href^='mailto:'] {
    text-decoration: none !important;
  }
  a[href^='http:']:not(.bare)::after,
  a[href^='https:']:not(.bare)::after {
    content: '(' attr(href) ')';
    display: inline-block;
    font-size: 0.875em;
    padding-left: 0.25em;
  }
  abbr[title]::after {
    content: ' (' attr(title) ')';
  }
  pre,
  blockquote,
  tr,
  img,
  object,
  svg {
    page-break-inside: avoid;
  }
  thead {
    display: table-header-group;
  }
  svg {
    max-width: 100%;
  }
  p,
  blockquote,
  dt,
  td.content {
    font-size: 1em;
    orphans: 3;
    widows: 3;
  }
  h2,
  h3,
  #toctitle,
  .sidebarblock > .content > .title {
    page-break-after: avoid;
  }
  #toc,
  .sidebarblock,
  .exampleblock > .content {
    background: none !important;
  }
  #toc {
    border-bottom: 1px solid #ddddd8 !important;
    padding-bottom: 0 !important;
  }
  .sect1 {
    padding-bottom: 0 !important;
  }
  .sect1 + .sect1 {
    border: 0 !important;
  }
  #header > h1:first-child {
    margin-top: 1.25rem;
  }
  body.book #header {
    text-align: center;
  }
  body.book #header > h1:first-child {
    border: 0 !important;
    margin: 2.5em 0 1em 0;
  }
  body.book #header .details {
    border: 0 !important;
    display: block;
    padding: 0 !important;
  }
  body.book #header .details span:first-child {
    margin-left: 0 !important;
  }
  body.book #header .details br {
    display: block;
  }
  body.book #header .details br + span::before {
    content: none !important;
  }
  body.book #toc {
    border: 0 !important;
    text-align: left !important;
    padding: 0 !important;
    margin: 0 !important;
  }
  body.book #toc,
  body.book #preamble,
  body.book h1.sect0,
  body.book .sect1 > h2 {
    page-break-before: always;
  }
  .listingblock code[data-lang]::before {
    display: block;
  }
  #footer {
    background: none !important;
    padding: 0 0.9375em;
  }
  #footer-text {
    color: rgba(0, 0, 0, 0.6) !important;
    font-size: 0.9em;
  }
  .hide-on-print {
    display: none !important;
  }
  .print-only {
    display: block !important;
  }
  .hide-for-print {
    display: none !important;
  }
  .show-for-print {
    display: inherit !important;
  }
}

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, #toctitle {
  font-style: normal;
  font-weight: 400;
}

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title {
  font-size: 1.0625rem;
}

a {
  white-space: nowrap;
}
.RemarquePreTitre {
  font-style: normal;
  font-weight: bold;
}
  .RemarquePreTitre::after {
    content: "‚Ä¢";
    padding-left: 5px;
  }
.admonitionblock {
}
.admonitionblock > table {
  border: 1px solid #ddddd8;
  box-shadow: 0 0 8px rgba(0,0,0,.1);
  margin: 1.5em 0;
  padding: 1em;
}
.icon .title {
  font-size: 2em;
}

.colist ol {
  margin-left: 1em;    /* aligns with the listing edge */
  font-weight: bold;   /* makes it stand out more */
}
.listingblock pre:not(.hljs),
.language-bash.hljs {
  background: #323232;
  color: wheat;
}
.language-bash.hljs .hljs-built_in,
.language-bash.hljs .hljs-builtin-name {
  color: white;
}
.language-bash.hljs .hljs-string {
  color: lightgreen;
}
.language-bash.hljs .hljs-variable {
  color: lightskyblue;
}
.keyseq {
  font-weight: normal;
  white-space: nowrap;
}
.language-bash.hljs .keyseq {
  color: white;
}
.language-bash.hljs kbd {
  background: transparent;
  box-shadow: none;
  color: white;
  font-size: 0.8em;
  font-weight: bold;
  padding: 0.1em 0.4em;
}

.listingblock pre.highlightjs > code {
  border-left: 4px solid #7a2518;
}
.listingblock pre.highlightjs > code.language-bash {
  border-color: #323232;
}

</style>
<style type="text/css">[data-interactive-runtime="loaded"] .interactive--javascript code[data-lang]:before {
  display: block;
  color: #00c72b;
  font-weight: bold;
  cursor: pointer;
}

  [lang="en"] [data-interactive-runtime="loaded"] .interactive--javascript code[data-lang]:before {
    content: "‚ñ∂ run code";
  }
  [lang="fr"] [data-interactive-runtime="loaded"] .interactive--javascript code[data-lang]:before {
    content: "‚ñ∂ voir le r√©sultat";
  }
  .interactive--javascript code[data-label]:before {
    content: attr(data-label);
  }

.interactive iframe {
  position: absolute;
  visibility: hidden;
}

.interactive.status--loaded iframe {
  position: inherit;
  visibility: visible;
}

.interactive.status--loading {
  opacity: .5;
}
</style>
<script>
(function(d){
  document.addEventListener('DOMContentLoaded', function(){
    const script = d.createElement('script');
    script.src = 'https://embed.runkit.com/';
    script.async = true;
    script.onload = function(){
      function makeListingInteractive (element){
  if (element.classList.contains('interactive--installed') || element.classList.contains('status--loading')) {
    return;
  }

  const code = element.querySelector('code');
  const nodeVersion = /interactive--runtime--node-([^\s]+)/.exec(element.className)[1];
  const isEndpoint = element.classList.contains('interactive--endpoint');
  const mode = isEndpoint ? 'endpoint' : null;
  let preamble = '';

  const source = code
    .textContent
    .replace(/\(\d+\)$/gm, '')
    .replace(/^["']?use strict["'][; ]*\n/, '');

  if (isEndpoint) {
    preamble = `process.nextTick(() => {
      if (typeof module.exports === 'function') {
        exports.endpoint = module.exports;
      }
      else if (typeof server !== 'undefined') {
        exports.endpoint = server.listeners("request").pop();
      }
});`
  }

  element.classList.add('status--loading');

  // eslint-disable-next-line no-undef
  RunKit.createNotebook({
    nodeVersion,
    element,
    source,
    mode,
    preamble,
    onLoad: function(ntbk) {
      element.classList.add('interactive--installed');
      element.classList.remove('status--loading');
      element.classList.add('status--loaded');
      code.parentNode.setAttribute('hidden', true);

      ntbk.evaluate();
    }
  });
}
function installEvents () {
  function getParent(el, condition) {
    let parent = el;

    while(parent = parent.parentNode) {
      if (condition(parent)) {
        return parent;
      }
    }
  }

  function hasClass(className) {
    return function check(el) {
      return el.classList.contains(className);
    }
  }

  document.querySelector('body').addEventListener('click', function(el) {
    if (el.target.classList.contains('language-javascript') || el.target.classList.contains('language-js')) {
      const parentNode = getParent(
        el.target,
        hasClass('interactive--javascript')
      );

      makeListingInteractive(parentNode);
    }
  });
}
      installEvents();
      document.body.dataset.interactiveRuntime = 'loaded';
    };
    document.body.appendChild(script);
  });
})(document);</script>
<style type="text/css">
.listingblock [data-bash-subs]::before {
  content: attr(data-bash-subs) " ";
  opacity: .5; }

.listingblock [data-bash-conum]::before {
  content: "(" attr(data-bash-conum) ")";
  font-weight: bold;
  opacity: .7;
}</style>
<script>
(function(d){
  d.addEventListener('DOMContentLoaded', function(){
    const script = d.createElement('script');
    script.src = 'https://wzrd.in/standalone/menuspy';
    script.async = true;
    script.onload = () => new menuspy(document.querySelector('#toc'), {enableLocationHash: false});
    d.body.appendChild(script);
  });
})(document);</script>
<style type="text/css">
#toc li.active > a[href^="#"] {
  background: #ffc;
  font-weight: bold;
}
#toc li.active > a[href^="#"]::before {
  content: "‚ñ∂ ";
  display: inline-block;
  position: absolute;
  margin-left: -1.2em;
  font-size: .8em;
  margin-top: 3px;
}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Cr√©er une application front-end</h1>
<div class="details">
<span id="revdate">2018-10-19</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table des mati√®res</div>
<ul class="sectlevel1">
<li><a href="#quel_rapport_entre_node_et_les_navigateursweb">1. Quel rapport entre Node et les navigateurs&#160;web ?</a></li>
<li><a href="#√©crire_d√®s_√†_pr√©sent_le_code_dufutur">2. √âcrire d√®s √† pr√©sent le code du&#160;futur</a>
<ul class="sectlevel2">
<li><a href="#la_fin_de_lapproche_par_le_d√©nominateur_commun">2.1. La fin de l&#8217;approche par le d√©nominateur commun</a></li>
<li><a href="#transpilation">2.2. √âcrire au plus proche des standards</a></li>
<li><a href="#polyfills">2.3. Combler les manques avec des polyfills</a></li>
</ul>
</li>
<li><a href="#modules">3. Importer des modules</a>
<ul class="sectlevel2">
<li><a href="#modules-script">3.1. La balise &lt;script&gt;</a></li>
<li><a href="#modules-es2015">3.2. Les modules ECMAScript</a></li>
<li><a href="#browserify">3.3. Importer des modules&#160;npm pour le&#160;Web</a></li>
<li><a href="#r√©capitulatif">3.4. R√©capitulatif</a></li>
</ul>
</li>
<li><a href="#conception_modulaire">4. Conception modulaire</a>
<ul class="sectlevel2">
<li><a href="#le_syndrome_du_plug_in_jquery">4.1. Le syndrome du plug-in jQuery</a></li>
<li><a href="#vers_une_approche_jquery_composite">4.2. Vers une approche jQuery composite</a></li>
<li><a href="#partager_le_code_m√©tier_avecnode">4.3. Partager le code m√©tier avec&#160;Node</a></li>
<li><a href="#s√©paration_du_fond_et_de_la_forme_donn√©es_rendu_et_interactions">4.4. S√©paration du fond et de la forme : donn√©es, rendu et interactions</a></li>
<li><a href="#react">4.5. Rapprocher donn√©es, rendu et interactions avec&#160;React</a></li>
</ul>
</li>
<li><a href="#io">5. Des requ√™tes Ajax au temps&#160;r√©el</a>
<ul class="sectlevel2">
<li><a href="#io-fetch">5.1. √âchange ponctuel de donn√©es avec <code>fetch()</code></a></li>
<li><a href="#io-eventsource">5.2. Approche unidirectionnelle avec EventSource</a></li>
<li><a href="#io-websocket">5.3. √âchanges en temps&#160;r√©el avec <em>WebSocket</em></a></li>
</ul>
</li>
<li><a href="#d√©velopper_au_quotidien">6. D√©velopper au quotidien</a>
<ul class="sectlevel2">
<li><a href="#watchify">6.1. Reconstruire en continu avec <code>watchify</code></a></li>
<li><a href="#livereload">6.2. Changements en temps&#160;r√©el dans le navigateur</a></li>
<li><a href="#node-sass">6.3. Modulariser ses feuilles de style avec&#160;Sass</a></li>
<li><a href="#ui-bundling">6.4. Lier composants visuels et feuilles de&#160;style</a></li>
<li><a href="#optimiser_ses_ressources_graphiques">6.5. Optimiser ses ressources graphiques</a></li>
</ul>
</li>
<li><a href="#testing">7. Tester son code</a>
<ul class="sectlevel2">
<li><a href="#testing-101">7.1. Que tester ?</a></li>
<li><a href="#soutiller_pour_√©crire_des_assertions">7.2. S&#8217;outiller pour √©crire des assertions</a></li>
<li><a href="#tester_ses_composants_react_sans_navigateur">7.3. Tester ses composants React sans navigateur</a></li>
<li><a href="#tester_code_et_composants_dans_les_navigateurs">7.4. Tester code et composants dans les navigateurs</a></li>
<li><a href="#ci">7.5. Int√©gration continue et compatibilit√© navigateurs</a></li>
</ul>
</li>
<li><a href="#conclusion">8. Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Node et l&#8217;√©cosyst√®me&#160;<code>npm</code> sont devenus des acteurs majeurs de l&#8217;outillage
web <em>front-end</em> alors profitons-en pour partager du code entre client et serveur.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Sommaire</div>
<ul>
<li>
<p>Polyfills et compatibilit√© ECMAScript</p>
</li>
<li>
<p>Importer des modules&#160;<code>npm</code> pour le&#160;Web</p>
</li>
<li>
<p>Cr√©er du code modulaire, avec ou sans <em>framework</em></p>
</li>
<li>
<p>√âchanges de donn√©es en temps&#160;r√©el</p>
</li>
<li>
<p>Outillage utile au quotidien</p>
</li>
<li>
<p>Tester son code et la compatibilit√© avec les navigateurs web</p>
</li>
</ul>
</div>
</div>
</div>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Avant l&#8217;apparition de Node, rare √©tait l&#8217;outillage n&#8217;imposant pas une ou
plusieurs plates-formes de d√©veloppement&#160;: <em>YUICompressor</em> demandait Java,
<em>Google Closure Compiler</em> demandait Java, <em>sprockets</em> Ruby et <em>pngquant</em>
quelques d√©pendances syst√®me comme <em>libpng</em>.</p>
</div>
<div class="paragraph">
<p>L&#8217;existence de Node et du registre <code>npm</code> a favoris√© le d√©veloppement d&#8217;un
√©cosyst√®me orient√© <em>front-end</em> plus simple √† appr√©hender.
Cela s&#8217;√©tend de la d√©couverte au t√©l√©chargement des biblioth√®ques tierces ainsi
qu&#8217;√† la compilation, l&#8217;optimisation et l&#8217;ex√©cution des tests des applications
web c√¥t√© client.</p>
</div>
<div class="paragraph">
<p><strong>Cet √©cosyst√®me rend l&#8217;√©criture de code moderne normale</strong>&#160;; un code anticipant
les futurs standards d&#8217;ECMAScript et <em>HTML5</em>, sur les navigateurs actuels et anciens.</p>
</div>
</blockquote>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Remarque</span> Versions de Node et npm</div>
<div class="paragraph">
<p>Le contenu de ce chapitre utilise les versions <strong>Node&#160;v10</strong>
et <strong>npm&#160;v6</strong>.
Ce sont les versions stables recommand√©es en&#160;2018.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quel_rapport_entre_node_et_les_navigateursweb">1. Quel rapport entre Node et les navigateurs&#160;web ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ce chapitre peut sembler confus au premier abord.
Si Node s&#8217;ex√©cute au niveau du syst√®me d&#8217;exploitation&#160;‚Äì &#8220;c√¥t√© serveur&#8221;&#160;‚Äì en quoi
est-il li√© au d√©veloppement <em>front-end</em>&#160;‚Äì &#8220;c√¥t√© client&#8221;&#160;?
Est-ce parce que du code √©crit pour Node peut aussi fonctionner dans un navigateur&#160;web&#160;?
Quid de l&#8217;utilisation de <code>require('fs')</code> pour acc√©der au syst√®me de fichiers&#160;?</p>
</div>
<div class="paragraph">
<p>La r√©ponse courte est&#160;: nous n&#8217;ex√©cutons pas Node dans un navigateur.</p>
</div>
<div class="paragraph">
<p>Et voici la r√©ponse longue&#160;: <strong>Node est utilis√© pour assembler du code</strong>, le <em>transformer</em>
et le rendre fonctionnel dans une paire de balises <code>&lt;script&gt;&lt;/script&gt;</code>.
Ce code peut aussi aussi bien √™tre fourni par des biblioth√®ques tierces
install√©es via&#160;<code>npm</code> (<em>jQuery</em>, <em>React</em> ou <em>d3</em> par exemple) que par de
l&#8217;outillage (optimiseurs, suite de tests, orchestration de t√¢ches) ou encore
par le code r√©utilisable de notre propre application&#160;web.</p>
</div>
<div class="paragraph">
<p>Il faut √©galement bien comprendre qu&#8217;il y a plusieurs &#8220;probl√®mes&#8221; cach√©s sous
une m√™me question&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les navigateurs et Node utilisent diff√©rentes machines virtuelles JavaScript,
impl√©mentant ECMAScript de fa√ßon plus ou moins compl√®te.</p>
</li>
<li>
<p>Ils n&#8217;ont pas acc√®s aux m√™mes APIs&#160;‚Äì Node acc√®de √† <code>fs</code> et <code>http</code> tandis que
les navigateurs ont <code>File</code> et <code>fetch</code>/<code>XmlHttpRequest</code>.</p>
</li>
<li>
<p>Ils ne g√®rent pas le chargement de modules de la m√™me mani√®re
(voir la section &#8220;<a href="#managing-dependencies">Gestion des d√©pendances</a>&#8221;).</p>
</li>
<li>
<p>L&#8217;impl√©mentation m√™me d&#8217;ECMAScript diff√®re selon les versions de Node
employ√©es&#160;‚Äì un navigateur moderne et Node&#160;v10 comprennent
l&#8217;objet natif <code>Promise</code>, mais pas Node&#160;0.12.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce processus n&#8217;est <em>pas magique</em> et nous verrons graduellement au cours des
prochaines sections comment tout ceci fonctionne.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Pratique</span> Jouer avec les exemples dans un terminal</div>
<div class="paragraph">
<p>Les exemples titr√©s d&#8217;un nom de fichier peuvent √™tre install√©s sur votre ordinateur.
Ex√©cutez-les dans un terminal et amusez-vous √† les modifier en parall√®le de
votre lecture pour voir ce qui change.</p>
</div>
<div class="listingblock">
<div class="title">Installation des exemples via le module npm <code>nodebook</code></div>
<div class="content">
<pre><span data-bash-subs="$"></span>npm install --global nodebook
<span data-bash-subs="$"></span>nodebook install chapter-09
<span data-bash-subs="$"></span>cd $(nodebook dir chapter-09)</pre>
</div>
</div>
<div class="paragraph">
<p>La commande suivante devrait afficher un r√©sultat qui confirme que vous √™tes
au bon endroit&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node hello.js</pre>
</div>
</div>
<div class="paragraph">
<p>Suivez √† nouveau les instructions d&#8217;installation pour r√©tablir les exemples
dans leur √©tat initial.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="√©crire_d√®s_√†_pr√©sent_le_code_dufutur">2. √âcrire d√®s √† pr√©sent le code du&#160;futur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transformer du code ECMAScript a pendant longtemps √©t√© chose p√©nible.
Je pense par exemple √† de la minification de code (pour r√©duire les temps de
transfert sur les antiques lignes ADSL&#160;128&#160;K) ou √† de la conversion automatique
de code ECMAScript&#160;3 en ECMAScript&#160;5.
Cela n√©cessitait syst√©matiquement l&#8217;utilisation d&#8217;un autre environnement
qu&#8217;ECMAScript lui-m√™me: Rhino n√©cessitait Java, Spidermonkey n√©cessitait&#160;C++
et Trident n√©cessitait un environnement Windows en plus de&#160;C++.</p>
</div>
<div class="paragraph">
<p><em>esprima</em> (<span class="URL"><a href="https://npmjs.com/esprima" class="bare">npmjs.com/esprima</a></span>) chamboule les r√®gles du jeu en
d√©cembre 2011&#160;: ce parseur ECMAScript&#160;‚Äì lui-m√™me √©crit en ECMAScript&#160;‚Äì
exporte une compr√©hension de code sous forme d&#8217;arbre syntaxique abstrait
(<em>Abstract Syntax Tree</em>, <em>AST</em>).
Cet arbre est lui-m√™me analysable par de nouveaux outils&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les <em>source maps</em> pour associer le code transform√© au code d&#8217;origine,
notamment dans les outils de d√©veloppement des navigateurs&#160;;</p>
</li>
<li>
<p>des minifieurs plus efficaces et ayant connaissance des portions de code ex√©cut√©es&#160;;</p>
</li>
<li>
<p>des analyseurs de code pour informer le d√©veloppeur d&#8217;erreurs de syntaxe,
de non-respect de styles de d√©veloppement, etc.&#160;;</p>
</li>
<li>
<p>des convertisseurs de code pour passer d&#8217;ECMAScript vers CoffeeScript,
de modules CommonJS vers des modules ECMAScript, etc.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Lien</span> Annonce d&#8217;esprima</div>
<div class="paragraph">
<p>Aryia&#160;Hidayat pr√©sente esprima dans ce billet de blog&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://ariya.io/2011/12/introducing-esprima" class="bare">ariya.io/2011/12/introducing-esprima</a></span></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il y pr√©sente notamment des comparatifs de performances d&#8217;ex√©cution sur
diff√©rentes machines virtuelles ECMAScript et face √† d&#8217;autres parseurs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="la_fin_de_lapproche_par_le_d√©nominateur_commun">2.1. La fin de l&#8217;approche par le d√©nominateur commun</h3>
<div class="paragraph">
<p>Qui n&#8217;a pas d√©j√† entam√© un projet en posant la question √† un client, en regardant
les statistiques de trafic ou en se posant une question √† soi-m√™me&#160;: quelles
sont les versions de navigateurs avec lesquelles notre site ou application web
doit √™tre compatible&#160;?</p>
</div>
<div class="paragraph">
<p>La version de navigateur la plus ancienne ou la moins conforme aux standards
√©tait celle qui donnait le&#160;<em>la</em>.
Cela voulait dire se priver de techniques modernes, standardis√©es ou en cours
de standardisation.
Cela signifiait des <em>hacks</em> dans ses CSS, dans son code ECMAScript et dans
ses ressources graphiques.</p>
</div>
</div>
<div class="sect2">
<h3 id="transpilation">2.2. √âcrire au plus proche des standards</h3>
<div class="paragraph">
<p>Fort heureusement, l&#8217;arriv√©e d'<em>esprima</em> change la donne et permet d&#8217;√©crire un
code proche des standards qui r√©siste au temps.
Son existence facilite l'<strong>√©mergence d&#8217;outils automatisant les transformations de code</strong>
pour satisfaire nos besoins sp√©cifiques.</p>
</div>
<div class="paragraph">
<p>Il y a plusieurs √©l√©ments √† prendre en compte concernant la standardisation
de nouvelles versions d&#8217;ECMAScript et les √©volutions de sa syntaxe&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La cadence de standardisation a √©t√© revue pour devenir pr√©dictible&#160;‚Äì une
volont√© d&#8217;une fois par&#160;an.</p>
</li>
<li>
<p>Les fonctionnalit√©s et √©l√©ments de syntaxe sont impl√©ment√©s un par un, √† des
vitesses diff√©rentes par les diff√©rents navigateurs.</p>
</li>
<li>
<p>Deux tiers de navigateurs fonctionnent sur des rythmes de mise √† jour en cycle court
(de six √† neuf semaines)&#160;‚Äì le tiers restant est cadenc√© √† une seule mise √†
jour par&#160;an.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il vaut mieux <strong>parier sur les standards comme strat√©gie √† long terme</strong> si on tient
compte du temps de d√©veloppement et du temps de maintenance d&#8217;une base de&#160;code.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Question</span> Standards, quels standards ?</div>
<div class="paragraph">
<p>Plusieurs organismes prennent part √† la standardisation de langages et
d&#8217;API lorsque l&#8217;on touche aux navigateurs&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTML&#160;: <em>WHATWG</em> (<span class="URL"><a href="https://html.spec.whatwg.org" class="bare">html.spec.whatwg.org</a></span>)&#160;;</p>
</li>
<li>
<p>API&#160;DOM&#160;: <em>WHATWG</em> (<span class="URL"><a href="https://dom.spec.whatwg.org" class="bare">dom.spec.whatwg.org</a></span>)&#160;;</p>
</li>
<li>
<p>CSS&#160;: <em>W3C</em> (<span class="URL"><a href="https://www.w3.org/standards/techs/css" class="bare">www.w3.org/standards/techs/css</a></span>)&#160;;</p>
</li>
<li>
<p>ECMAScript&#160;: <em>TC39</em> (<span class="URL"><a href="https://github.com/tc39" class="bare">github.com/tc39</a></span>)&#160;;</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lorsque nous √©crivons du code, nous pouvons rencontrer trois cas de figure&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>√©l√©ment de syntaxe non&#160;impl√©ment√©&#160;: transformer le code pour l&#8217;adapter aux
navigateurs cibles&#160;;</p>
</li>
<li>
<p>√©l√©ment de syntaxe partiellement impl√©ment√©&#160;: utiliser l&#8217;impl√©mentation native
des navigateurs et, √† d√©faut, transformer le code pour l&#8217;adapter aux autres navigateurs&#160;;</p>
</li>
<li>
<p>√©l√©ment de syntaxe totalement impl√©ment√©&#160;: utiliser l&#8217;impl√©mentation native des navigateurs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il arrive que certains √©l√©ments de syntaxe soient abandonn√©s pendant le
processus de standardisation&#160;‚Äì ou que leur impl√©mentation change beaucoup
(on pensera √† <code>Object.observe</code>).</p>
</div>
<div class="paragraph">
<p>La question qui nous taraude est&#160;: comment transformer le code pour satisfaire
√† la fois les navigateurs compatibles et les autres&#160;?
<em>Babel</em> (<span class="URL"><a href="https://babel.io" class="bare">babel.io</a></span>) est un outil de choix  pour parvenir √† ces
fins d&#8217;√©criture de code r√©sistant au(x standards du) temps.</p>
</div>
<div class="paragraph">
<p>Ce module convertit de mani√®re s√©lective toute syntaxe ECMAScript&#160;2015/2016/etc.
vers de l&#8217;ECMAScript&#160;5, compr√©hensible par les navigateurs modernes.
L&#8217;int√©r√™t de sa <em>s√©lectivit√©</em> fait que l&#8217;on peut progressivement arr√™ter de
convertir les √©l√©ments de syntaxe couverts par 100&#160;% des navigateurs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Histoire</span> Traceur</div>
<div class="paragraph">
<p><em>Traceur</em> est un des premiers transpilateurs ECMAScript&#160;2015 vers
ECMAScript&#160;5 √† avoir √©merg√© dans l&#8217;√©cosyst√®me&#160;Node.</p>
</div>
<div class="paragraph">
<p>Gr√¢ce √† lui, il a √©t√© possible d&#8217;√©crire des modules en ECMAScript&#160;2015
bien avant que la sp√©cification ne soit enti√®rement termin√©e et donc on a pu
anticiper son apprentissage tout en mettant le langage √† l&#8217;√©preuve avant sa finalisation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>L&#8217;exemple suivant illustre un code utilisant des √©l√©ments de syntaxe
d&#8217;ECMAScript&#160;2018.</p>
</div>
<div class="listingblock">
<div class="title">babel/es2018.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const a = {one: 1, two: 2};
const b = {three: 3, four: 4};

console.log({...a, ...b});      <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Affiche <code>{ one: 1, two: 2, three: 3, four: 4 }</code> si le navigateur supporte l&#8217;op√©rateur <em>spread</em> sur les objets (<a href="../chapter-03/index.html#object.assign">chapitre&#160;3</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ce code repr√©sente l&#8217;id√©al de ce que l&#8217;on souhaite √©crire.
Le seul obstacle consiste √† traduire ce code pour l&#8217;ensemble des navigateurs
compatibles avec ECMAScript&#160;5.</p>
</div>
<div class="paragraph">
<p>Ex√©cutons cette commande&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>npm run babel -- examples/babel/es2018.js</pre>
</div>
</div>
<div class="paragraph">
<p>La sortie a chang√© et renvoie un code totalement fonctionnel sur des navigateurs
ne prenant pas ECMAScript&#160;2018 en charge&#160;:</p>
</div>
<div class="listingblock">
<div class="title">babel/es2018-es5.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">"use strict";

function _objectSpread(target) { for (var i = 1; i &lt; arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var a = {one: 1, two: 2};
var b = {three: 3, four: 4};

console.log(_objectSpread({}, a, b));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque fonctionnalit√© d&#8217;ECMAScript est transform√©e selon une r√®gle personnalisable,
int√©gr√©e √† <em>Babel</em> ou disponible sous forme d&#8217;un <em>plug-in</em>.
Les <em>presets</em> sont des modules&#160;<code>npm</code> qui regroupent les r√®gles
de transformation selon un certaine logique.</p>
</div>
<div class="paragraph">
<p><em>preset-env</em> <span class="URL"><a href="https://npmjs.com/babel-preset-env" class="bare">npmjs.com/babel-preset-env</a></span> convertit
notre code dans une version compatible avec la majorit√© des navigateurs
support√©s sur le march√©.
Si vos besoins sont diff√©rents, sa configuration sait cibler des navigateurs
en fonction soit de leur version, soit de leur part de march√©.</p>
</div>
<div class="paragraph">
<p>La configuration des presets et d&#8217;autres aspects de Babel se fait
dans un fichier nomm√© <code>.babelrc</code>.
L&#8217;exemple suivant configure Babel pour pr√©server les commentaires,
transformer la syntaxe JSX pour <a href="#react">React</a> et transformer pour les
derni√®res versions des navigateurs sur le march√©&#160;:</p>
</div>
<div class="listingblock">
<div class="title">.babelrc</div>
<div class="content">
<pre>{
  "comments": false,
  "presets": [
    "@babel/preset-react",
    "@babel/preset-env"
  ],
  "plugins": [
    "@babel/plugin-proposal-object-rest-spread"
  ]
}</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Lien</span> Documentation de Babel</div>
<div class="paragraph">
<p>Toutes les options de configuration sont document√©es sur le site officiel
de Babel&#160;: <span class="URL"><a href="https://babeljs.io/docs/en/babel-core/#options" class="bare">babeljs.io/docs/en/babel-core/#options</a></span>.</p>
</div>
<div class="paragraph">
<p>Une autre page explique o√π placer et quoi mettre dans les fichiers
<code>.babelrc</code>&#160;: <span class="URL"><a href="https://babeljs.io/docs/en/config-files/" class="bare">babeljs.io/docs/en/config-files/</a></span>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="polyfills">2.3. Combler les manques avec des polyfills</h3>
<div class="paragraph">
<p>Des outils comme Babel nous permettent d&#8217;√©crire avec une syntaxe moderne qui
<strong>comblent les fonctionnalit√©s manquantes</strong>&#160;‚Äì leur impl√©mentation.</p>
</div>
<div class="paragraph">
<p>Un <em>polyfill</em> harmonise la pr√©sence d&#8217;une fonctionnalit√© au sein d&#8217;une vari√©t√© de
navigateurs et d&#8217;environnements ECMAScript.
Cela se fera au d√©triment de quelques kilo-octets de code √† charger en plus
dans nos applications.
L&#8217;appel √† un service de <em>polyfill</em> externe entra√Æne un l√©ger ralentissement du
chargement de notre&#160;page.</p>
</div>
<div class="paragraph">
<p>Prenons le bloc de code suivant&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">'use strict';

Promise.resolve('ok');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comprenons que&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cette syntaxe est valide dans toutes les versions d&#8217;ECMAScript
(Babel ne change rien √† ce code).</p>
</li>
<li>
<p>L&#8217;objet global <code>Promise</code> existe dans un navigateur moderne.</p>
</li>
<li>
<p>L&#8217;objet global <code>Promise</code> n&#8217;existe pas dans <em>Internet Explorer 11</em>, entre autres.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce code fonctionnerait donc sur un navigateur moderne mais pas dans <em>IE11</em>.
L&#8217;inclusion d&#8217;un <em>polyfill</em> de <code>Promise</code> r√©soudrait le probl√®me.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Bonne pratique</span> Quand inclure les polyfills ?</div>
<div class="paragraph">
<p><strong>Un <em>polyfill</em> se charge toujours en premier</strong>.
On incluet tous les <em>polyfills</em> d&#8217;un coup avant notre propre code.</p>
</div>
<div class="paragraph">
<p>Nous garantissons ainsi coh√©rence et stabilit√© de comportement au sein de
notre application, peu importe l&#8217;ordre d&#8217;ex√©cution de nos scripts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Parlons maintenant des m√©thodes d&#8217;inclusion des <em>polyfills</em> pour mieux
comprendre comment proc√©der.</p>
</div>
<div class="paragraph">
<p>Le service <em>polyfill.io</em> est de loin la m√©thode la plus simple √† utiliser.
Il suffit d&#8217;inclure un script dans toutes vos pages web et cet outil
d√©termine les <em>polyfills</em> √† charger en fonction de la
compatibilit√© du navigateur&#160;:</p>
</div>
<div class="listingblock">
<div class="title">polyfill.io.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Example polyfill.io&lt;/title&gt;
    &lt;script src="https://cdn.polyfill.io/v2/polyfill.min.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script&gt;
      Promise.resolve('ok')
        .then(msg =&gt; console.log(msg));
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> polyfill.io</div>
<div class="paragraph">
<p><em>polyfill.io</em> poss√®de une documentation tr√®s compl√®te qui aide √† configurer
finement le service en fonction de nos besoins&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://qa.polyfill.io/v2/docs/" class="bare">qa.polyfill.io/v2/docs/</a></span></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous pouvons d√©duire deux r√®gles de cet exemple&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inclure les <em>polyfills</em> en tout premier.</p>
</li>
<li>
<p>Les inclure en dehors de notre code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La deuxi√®me m√©thode est d&#8217;embarquer les <em>polyfills</em> dans notre base de code.
L&#8217;avantage est de ma√Ætriser notre base de code et de ne pas d√©pendre d&#8217;un service externe.
L&#8217;inconv√©nient est que nous chargeons du code qui sera inutile dans les navigateurs et environnements disposant d√©j√† de ces fonctionnalit√©s&#160;:</p>
</div>
<div class="listingblock">
<div class="title">polyfill-import.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Exemple polyfill custom&lt;/title&gt;
    &lt;script type="module"&gt;
      import 'es6-promise/auto';        <b class="conum">(1)</b>
      import 'core-js/fn/number/is-nan';<b class="conum">(2)</b>
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script&gt;
      Promise.resolve(Number.isNaN(NaN))
        .then(msg =&gt; console.log(msg));
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous verrons <a href="#modules">comment importer des modules</a> ci-apr√®s.</p>
</li>
<li>
<p>On importe un deuxi√®me <em>polyfill</em>, celui de la m√©thode <code>Number.isNaN</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le module <em>npm</em> <code>core-js</code> est une biblioth√®que exhaustive de <em>polyfills</em>
pouvant √™tre inclus un √† un ou par versions d&#8217;ECMAScript.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> core-js</div>
<div class="paragraph">
<p>La documentation en ligne de <code>core-js</code> liste l&#8217;ensemble des <em>polyfills</em>
pris en charge, ainsi que des exemples d&#8217;utilisation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://npmjs.com/core-js" class="bare">npmjs.com/core-js</a></span></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">‚ö†Ô∏è</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Attention</span> Performance et duplication</div>
<div class="paragraph">
<p>Il faut veiller √† ne pas alourdir inutilement une application.</p>
</div>
<div class="paragraph">
<p>Laissons la responsabilit√© de <em>polyfiller</em> aux utilisateurs de notre code&#160;;
particuli√®rement si celui-ci est redistribu√© en tant que module&#160;<code>npm</code> public.</p>
</div>
<div class="paragraph">
<p>Si plusieurs scripts n√©cessitent des <em>polyfills</em>, mieux vaut inclure ces
derniers en une&#160;fois&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;script src="polyfills.js"&gt;&lt;/script&gt;
&lt;script src="script-a.js"&gt;&lt;/script&gt;
&lt;script src="script-b.js"&gt;&lt;/script&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enfin, une derni√®re m√©thode est d&#8217;importer la fonction de <em>polyfill</em> sans
r√©√©crire les objets globaux.
Cette pratique a l&#8217;avantage de ne pas entra√Æner d&#8217;effets secondaires et de
garantir le m√™me comportement dans tous les navigateurs.
L&#8217;inconv√©nient est qu&#8217;on n&#8217;utilise pas la fonctionnalit√© native des navigateurs
lorsqu&#8217;elle est pr√©sente.
Nous nous retrouvons tributaires de la qualit√© d&#8217;impl√©mentation du <em>polyfill</em>.</p>
</div>
<div class="listingblock">
<div class="title">polyfill-require.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import {Promise as PromisePolyfill} from 'es6-promise';

PromisePolyfill.resolve('ok').then(msg =&gt; console.log(msg));

console.log('Promise' in window);                <b class="conum">(1)</b>
console.log(PromisePolyfill === window.Promise); <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Affiche <code>true</code> si le navigateur impl√©mente l&#8217;API <em>Promise</em>&#160;‚Äì sinon affiche <code>false</code> et l&#8217;utilisation d&#8217;un <em>polyfill</em> prend tout son&#160;sens.</p>
</li>
<li>
<p>Affiche <code>false</code>, car le <em>polyfill</em> de <em>Promise</em> est une fonction strictement diff√©rente de <code>window.Promise</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Guide</span> Bonnes pratiques constat√©es</div>
<div class="paragraph">
<p>De bons usages des <em>polyfills</em> ainsi les risques li√©s √† leur utilisation
sont compil√©s dans un guide √©dit√© par le&#160;W3C&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://w3ctag.github.io/polyfills/" class="bare">w3ctag.github.io/polyfills/</a></span></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modules">3. Importer des modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Importer des modules est une pratique courante avec Node.
Elle l&#8217;est en revanche beaucoup moins dans l&#8217;univers du Web puisqu&#8217;il n&#8217;existait
rien de natif avant les <a href="#modules-es2015">modules ECMAScript</a>.</p>
</div>
<div class="paragraph">
<p>Auparavant, on aura vu d√©barquer les modules AMD (<em>Asynchronous Module Definition</em>)
pour g√©rer les d√©pendances entre scripts.
Les biblioth√®ques Dojo, RequireJS et YUI ont popularis√© ce motif de conception.
Un d√©sir d&#8217;universalit√© a ensuite √©merg√© avec le gain de popularit√© croissant de Node,
conduisant aux modules&#160;UMD, conciliant AMD et CommonJS.</p>
</div>
<div class="paragraph">
<p>Les modules ECMAScript ont √©merg√© de ce bouillonnement.</p>
</div>
<div class="sect2">
<h3 id="modules-script">3.1. La balise &lt;script&gt;</h3>
<div class="paragraph">
<p>Rappelons-le, la m√©thode incontournable pour charger du code dans un navigateur
est l&#8217;utilisation de la base <code>&lt;script&gt;</code>.
Le chargement, l&#8217;√©valuation et l&#8217;ex√©cution du script bloquent le temps
n√©cessaire au rendu d&#8217;un document&#160;HTML.</p>
</div>
<div class="listingblock">
<div class="title">import/script.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;script src="global-dom-log.js"&gt;&lt;/script&gt;
&lt;script src="script.js"&gt;&lt;/script&gt;

&lt;div id="logs"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les diff√©rents scripts partagent le m√™me espace m√©moire, permettant ainsi √†
<code>script.js</code> d&#8217;avoir acc√®s √† la fonction <code>log</code> d√©finie dans <code>global-dom-log.js</code>.</p>
</div>
<div class="listingblock">
<div class="title">import/global-dom-log.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const log = (message) =&gt; {
  const text = String(message).trim();

  document.querySelector('#logs').textContent = text;
};</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">import/script.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">/* global log */
window.addEventListener('load', () =&gt; {
  log('OK');<b class="conum">(2)</b>
});

log('KO');  <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Affiche une erreur car <code>&lt;div id="logs"&gt;</code> n&#8217;existe pas encore dans le document
√† ce stade de l&#8217;ex√©cution.</p>
</li>
<li>
<p>Cette ligne est ex√©cut√©e une fois le document charg√©&#160;‚Äì <code>&lt;div id="logs"&gt;</code>
contient d√©sormais le texte&#160;<code>OK</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>S&#8217;il est facile d&#8217;ajouter du code dans le navigateur, on constate plusieurs probl√®mes&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Partager du code entre scripts repose sur une attente explicite.</p>
</li>
<li>
<p>Le partage de variables entre scripts risque d&#8217;entra√Æner des collisions
(par exemple, deux variables du m√™me nom d√©finies dans des scripts diff√©rents).</p>
</li>
<li>
<p>Il n&#8217;y a pas de moyen √©vident de rendre des parties de code priv√©es au sein de
chaque script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le d√©veloppement <em>front-end</em> bas√© sur de l&#8217;outillage Node va justement nous aider
√† <strong>solidifier et renforcer la r√©utilisabilit√© de notre&#160;code</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="modules-es2015">3.2. Les modules ECMAScript</h3>
<div class="paragraph">
<p>Nous avons √©voqu√© les <a href="../chapter-03/index.html#primitives">primitives ECMAScript&#160;2015</a> dans le chapitre&#160;3.
Les modules font partie des fonctionnalit√©s tant attendues.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/module-import.png" alt="module import" width="85%">
</div>
<div class="title">Figure 1. Utilisation des modules ECMAScript dans un navigateur web (ici, Safari pour macOS)</div>
</div>
<div class="paragraph">
<p>L&#8217;attribut <code>type="module"</code> sert √† maintenir une compatibilit√© entre les scripts
classiques et les modules ECMAScript.
Ce m√©canisme s&#8217;appuie sur plusieurs concepts importants&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Toute variable est priv√©e sauf si elle est export√©e avec l&#8217;op√©rateur <code>export</code>.</p>
</li>
<li>
<p>Les modules sont explicitement inclus avec l&#8217;op√©rateur <code>import</code>.</p>
</li>
<li>
<p>Les variables globales d√©finies par l&#8217;utilisateur ne sont pas accessibles depuis un module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Retravaillons le document HTML de la section pr√©c√©dente&#160;:</p>
</div>
<div class="listingblock">
<div class="title">import/import.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;script&gt;const pro = 'test';&lt;/script&gt;
&lt;script type="module" src="script-import.js"&gt;&lt;/script&gt;

&lt;div id="logs"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nous voulons maintenant (sa)voir si la variable&#160;<code>pro</code> d√©finie avant l&#8217;inclusion
du module <code>script-import.js</code> est accessible.
Nous voulons √©galement savoir si la syntaxe d&#8217;import de la fonction&#160;<code>log</code> fonctionne&#160;:</p>
</div>
<div class="listingblock">
<div class="title">import/script-import.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import {log} from './dom-log.js';

console.log(typeof pro);    <b class="conum">(1)</b>
console.log(typeof log);    <b class="conum">(2)</b>
console.log(typeof window); <b class="conum">(3)</b>

window.addEventListener('load', () =&gt; {
  log('OK');
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Affiche <code>undefined</code>.</p>
</li>
<li>
<p>Affiche <code>function</code>.</p>
</li>
<li>
<p>Affiche <code>object</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>De m√™me que nous avons utilis√© <code>import</code> pour importer de mani√®re s√©lective une
fonction du module <code>dom-log.js</code>, l&#8217;op√©rateur <code>export</code> nous aide √† exposer des
objets, fonctions et variables&#160;:</p>
</div>
<div class="listingblock">
<div class="title">import/dom-log.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">export function log(message, target = '#logs') {
  const text = String(message).trim();

  document.querySelector(target).textContent = text;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="browserify">3.3. Importer des modules&#160;npm pour le&#160;Web</h3>
<div class="paragraph">
<p>Qu&#8217;en est-il alors des modules&#160;<code>npm</code>&#160;?
Nous pouvons transpiler et importer du code.
Ce serait tr√®s utile si nous pouvions √©galement importer du code tiers.
Cela nous √©viterait de r√©inventer la roue, nous donnerait acc√®s √† du code bien test√©
et trop co√ªteux √† √©crire nous-m√™mes.</p>
</div>
<div class="paragraph">
<p>Nous avons vu comment <a href="../chapter-05/index.html#modules">charger des modules&#160;<code>npm</code></a>
dans le chapitre 5.
Int√©ressons-nous √† leur utilisation dans le contexte d&#8217;une application <em>front-end</em>.
Pour cela, adaptons l&#8217;exemple de la section pr√©c√©dente&#160;:</p>
</div>
<div class="listingblock">
<div class="title">import/script-import-jquery.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import $ from 'jquery';

console.log($.fn.jquery);  <b class="conum">(1)</b>

$(document).ready(() =&gt; {
  $('#logs').text('OK');   <b class="conum">(2)</b>
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>$.fn.jquery</code> contient le num√©ro de version de jQuery.</p>
</li>
<li>
<p>Substitut jQuery pour remplacer le texte dans <code>&lt;div id="logs"&gt;</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le document HTML chargeant ce module est en tout point similaire au pr√©c√©dent exemple&#160;:</p>
</div>
<div class="listingblock">
<div class="title">import/import-jquery.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;script type="module" src="script-import-jquery.js"&gt;&lt;/script&gt;

&lt;div id="logs"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le seul hic, c&#8217;est que <strong>cela ne fonctionne pas</strong>&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le navigateur ne peut pas savoir o√π se trouve la d√©pendance demand√©e.</p>
</li>
<li>
<p>Rien ne garantit que <code>jquery</code> expose son code en tant que module ECMAScript.</p>
</li>
<li>
<p>On n&#8217;a certainement pas envie d&#8217;exposer publiquement le r√©pertoire <code>node_modules</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>C&#8217;est alors qu&#8217;entre en jeu <strong>browserify</strong>.
<em>browserify</em> est un outil g√©n√©rique de transformation de code.
Il peut √™tre utilis√© en ligne de commande, via son API Node, mais aussi par
le biais de plug-in pour d&#8217;autres outils (comme Gulp ou Grunt).</p>
</div>
<div class="paragraph">
<p><em>browserify</em> a √©t√© initialement cr√©√© pour transformer du code √©crit pour Node en
code fonctionnel dans les navigateurs.
Il expose notamment un concept d&#8217;int√©grations (les <em>transforms</em>) afin d&#8217;effectuer
des remplacements ligne √† ligne.</p>
</div>
<div class="paragraph">
<p>L√† o√π <em>Babel</em> cherche uniquement √† traduire un langage vers un autre, <em>browserify</em> est le couteau suisse pour effectuer des remplacements majeurs dans le code&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>portage de la fonction <code>require()</code> et inclusion du code des modules sous-jacents&#160;;</p>
</li>
<li>
<p>suppression de code conditionnel&#160;;</p>
</li>
<li>
<p>remplacement d&#8217;API sp√©cifiques √† Node par des <em>polyfills</em> pour le&#160;Web&#160;;</p>
</li>
<li>
<p>extraction de&#160;CSS&#160;;</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>browserify</em> est int√©ressant au sens o√π il nous apprend √† nous constituer
notre outillage, pour nos propres besoins.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Guide</span> Utiliser browserify</div>
<div class="paragraph">
<p><em>browserify</em> (<span class="URL"><a href="https://npmjs.com/browserify" class="bare">npmjs.com/browserify</a></span>) est un outil extr√™mement
adaptable, modulaire et puissant.
Son apprentissage progressif peut faire de lui un alli√© de choix dans tous
vos projets Node et&#160;Web.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://github.com/substack/browserify-handbook" class="bare">github.com/substack/browserify-handbook</a></span></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Revenons maintenant √† notre code auquel il manque la compr√©hension des
modules&#160;<code>npm</code>.
Nous allons maintenant chercher √† transformer le fichier <code>script-import-jquery.js</code>,
non seulement pour rendre la syntaxe <code>import</code> intelligible
(c&#8217;est le <a href="#transpilation">r√¥le de Babel</a>), mais aussi pour faire le
lien avec les modules&#160;<code>npm</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>npm run browserify -- \
  -t babelify \
  -e examples/import/script-import-jquery.js \
  -o examples/import/script-import-jquery-browserify.js</pre>
</div>
</div>
<div class="paragraph">
<p>Cette commande ex√©cute trois choses&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-t babelify</code> indique d&#8217;utiliser une int√©gration Babel (un <em>transform</em>) pour
transformer la syntaxe ECMAScript&#160;2015.</p>
</li>
<li>
<p><code>-e &#8230;&#8203;</code> indique le script d&#8217;entr√©e √† transformer.</p>
</li>
<li>
<p><code>-o &#8230;&#8203;</code> indique o√π stocker le script transform√©.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il en r√©sultera un fichier nomm√© <code>script-import-jquery-browserify.js</code> compatible
ECMAScript&#160;5 et qui inclut d√©sormais le code source de jQuery.</p>
</div>
<div class="paragraph">
<p>Il ne nous reste plus qu&#8217;√† charger le fichier transform√© dans notre page web pour
voir le r√©sultat&#160;:</p>
</div>
<div class="listingblock">
<div class="title">import/import-jquery-browserify.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;script src="script-import-jquery-browserify.js"&gt;&lt;/script&gt;

&lt;div id="logs"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="r√©capitulatif">3.4. R√©capitulatif</h3>
<div class="paragraph">
<p>En r√©sum√©, nous avons besoin de nous baser sur deux ou trois outils pour √©crire
un code modulaire et compatible avec n&#8217;importe quel type de syntaxe&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Babel pour transformer la syntaxe&#160;;</p>
</li>
<li>
<p>des <em>polyfills</em> pour harmoniser les fonctionnalit√©s&#160;;</p>
</li>
<li>
<p><em>browserify</em> pour l&#8217;int√©gration avec les modules&#160;<code>npm</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ceux-ci ont l&#8217;avantage d&#8217;√™tre faciles √† prendre en main, modulaires et √©volutifs.
Nous pourrons aussi nous tourner vers d&#8217;autres outils de transformation de code
pour explorer d&#8217;autres horizons&#160;‚Äì et il en existe √©norm√©ment&#160;: webpack, rollup,
broccoli, etc.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conception_modulaire">4. Conception modulaire</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un autre paradigme change avec la mise √† disposition des modules et de
l&#8217;outillage&#160;: le code que l&#8217;on √©crit d√©pend surtout d&#8217;ECMAScript et de
l&#8217;environnement dans lequel on l&#8217;ex√©cute, √† savoir Node ou un navigateur.</p>
</div>
<div class="paragraph">
<p>La section suivante s&#8217;int√©resse √† l&#8217;√©volution de l&#8217;√©criture du code, autrefois
dirig√©e par la structure du document HTML, vers un monde de
fonctions consommant des donn√©es, transform√©es pour un type d&#8217;affichage, que ce
soit HTML ou autre.</p>
</div>
<div class="paragraph">
<p>Nous illustrerons cette √©volution au travers d&#8217;un exemple relativement simple&#160;:
une balise HTML affichant l&#8217;heure dont nous actualisons le contenu toutes les secondes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/modules-time.png" alt="modules time" width="85%">
</div>
<div class="title">Figure 2. R√©sultat de l&#8217;exemple d√©velopp√© dans les sections suivantes</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> <em>jQuery</em></div>
<div class="paragraph">
<p>Les exemples suivants se basent sur l&#8217;utilisation de la biblioth√®que <em>jQuery</em>
(<span class="URL"><a href="https://api.jquery.com" class="bare">api.jquery.com</a></span>).</p>
</div>
<div class="paragraph">
<p>Elle facilite la manipulation du DOM tout en g√©rant les incompatibilit√©s des
diff√©rents navigateurs.
Son utilisation est devenue moins dominante du fait d&#8217;une nette am√©lioration de
la qualit√© de ces derniers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="http://learn.jquery.com/using-jquery-core/" class="bare">learn.jquery.com/using-jquery-core/</a></span></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="le_syndrome_du_plug_in_jquery">4.1. Le syndrome du plug-in jQuery</h3>
<div class="paragraph">
<p>Ce que j&#8217;appelle le &#8220;syndrome du plug-in <em>jQuery</em>&#8221;, c&#8217;est une combinaison
des √©l√©ments suivants&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cr√©ation de code m√©tier inutilisable en dehors de <em>jQuery</em>&#160;;</p>
</li>
<li>
<p>m√©lange de la pr√©sentation des donn√©es et de l&#8217;organisation du code m√©tier&#160;;</p>
</li>
<li>
<p>un code aveugle car √©loign√© de la structure HTML n√©cessaire √† son fonctionnement&#160;;</p>
</li>
<li>
<p>fragilit√© du code en cas de changement de la structure HTML associ√©e&#160;;</p>
</li>
<li>
<p>en g√©n√©ral, un code difficilement testable&#160;‚Äì difficile de ne pas aboutir √† une interface bogu√©e.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Voici un exemple de document HTML fragile et m√©langeant tous les concepts en m√™me temps.
Il est parfaitement valide, mais illustre un ensemble de pratiques courantes que
nous allons chercher √† d√©construire.</p>
</div>
<div class="listingblock">
<div class="title">modules/jquery-plugin.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;body&gt;
  &lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;

  &lt;time datetime="" data-interval="1000"&gt;---&lt;/time&gt;

  &lt;script src="../../node_modules/jquery/dist/jquery.js"&gt;&lt;/script&gt;
  &lt;script src="jquery-plugin.js"&gt;&lt;/script&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maintenant que la structure HTML est d√©finie, nous devons √©crire le
code affichant l&#8217;heure dans un √©l√©ment HTML toutes les secondes&#160;:</p>
</div>
<div class="listingblock">
<div class="title">modules/jquery-plugin.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">/* global jQuery */

($ =&gt; {
  $.fn.displaySeconds = function displaySeconds() {
    this.each((i, dateElement) =&gt; {
      setInterval(() =&gt; {                  <b class="conum">(1)</b>
        const now = new Date();            <b class="conum">(2)</b>
        const seconds = now.getSeconds();

        $(dateElement)                     <b class="conum">(3)</b>
          .removeClass(seconds % 2 ? 'pair': 'impair')
          .addClass(seconds % 2 ? 'impair': 'pair')
          .attr('datetime', now.toISOString())
          .text(now.toLocaleTimeString());
      }, $(dateElement).data('interval')); <b class="conum">(4)</b>
    });

    return this;
  };

  $(document).ready(() =&gt; {      <b class="conum">(5)</b>
    $('time').displaySeconds();  <b class="conum">(6)</b>
  });
})(jQuery);</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ce bloc de code est ex√©cut√© toutes les secondes.</p>
</li>
<li>
<p>La donn√©e de temps est obtenue chaque seconde par notre <em>plug-in jQuery</em>.</p>
</li>
<li>
<p>Certaines d√©cisions m√©tier sont m√©lang√©es avec l&#8217;affichage de la donn√©e temps.</p>
</li>
<li>
<p>L&#8217;intervalle est d√©termin√© par la valeur de l&#8217;attribut <code>data-interval</code>.</p>
</li>
<li>
<p>Ce bloc de code est ex√©cut√© d√®s que le document HTML est pr√™t&#160;‚Äì toute sa structure HTML est disponible.</p>
</li>
<li>
<p>Le plug-in <em>jQuery</em> est appliqu√© √† toutes les occurrences de <code>&lt;time&gt;</code> dans lequel il est ex√©cut√©.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Certains motifs illustr√©s dans la section &#8220;<a href="#modules">Importer des modules</a>&#8221;
refont surface&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Variables globales&#160;: que faire si <code>jQuery</code> n&#8217;existe pas&#160;?</p>
</li>
<li>
<p>Connaissance implicite du document&#160;: que faire si une personne tierce remplace
la balise <code>&lt;time&gt;</code> par une autre balise&#160;?</p>
</li>
<li>
<p>Code ECMAScript pilot√© par le document&#160;: que faire si une personne tierce
exprime l&#8217;intervalle en secondes et non en millisecondes&#160;?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La faute n&#8217;est pas vraiment celle de <em>jQuery</em> mais plut√¥t la n√¥tre&#160;‚Äì enfin, la mienne.
Nous avons m√©lang√© r√®gles de fonctionnement (contenu de balise, classe&#160;CSS
√† ajouter/enlever) et donn√©es (date courante, parit√© des secondes, √©v√©nement de
mise √† jour <code>setInterval()</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="vers_une_approche_jquery_composite">4.2. Vers une approche jQuery composite</h3>
<div class="paragraph">
<p>Nous allons maintenant reprendre les concepts appris pr√©c√©demment et conserver
le m√™me outil, √† savoir <em>jQuery</em>.
Certains outils encouragent de bons motifs de conception et donnent la sensation
de r√©soudre des probl√®mes.
Apprendre ces motifs et √† capitaliser sur les outils que nous connaissons d√©j√†
peuvent nous emmener tout aussi&#160;loin.</p>
</div>
<div class="listingblock">
<div class="title">modules/jquery-app.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;body&gt;
  &lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;

  &lt;time datetime=""&gt;---&lt;/time&gt;

  &lt;script src="jquery-app-browserify.js"&gt;&lt;/script&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le changement majeur r√©side dans la r√©organisation du code applicatif&#160;:</p>
</div>
<div class="listingblock">
<div class="title">modules/jquery-app.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import $ from 'jquery';
import timerFn from './timer.js';                   <b class="conum">(4)</b>

const displaySeconds = (tickData, dateElement) =&gt; { <b class="conum">(5)</b>
  const {className, now} = tickData;

  $(dateElement)                                    <b class="conum">(6)</b>
    .attr('class', className)
    .attr('datetime', now.toISOString())
    .text(now.toLocaleTimeString());
};

$(document).ready(() =&gt; {
  const dateElements = $('time').get();             <b class="conum">(1)</b>
  const onTick = tickData =&gt; {                      <b class="conum">(2)</b>
    dateElements.forEach(el =&gt; displaySeconds(tickData, el));
  };

  timerFn({ interval: 1000, onTick });              <b class="conum">(3)</b>
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous s√©lectionnons les √©l√©ments de la page √† actualiser chaque seconde.</p>
</li>
<li>
<p>Nous d√©finissons quoi faire avec les donn√©es transmises chaque seconde.</p>
</li>
<li>
<p>Nous d√©marrons un minuteur.</p>
</li>
<li>
<p>Le minuteur est une fonction externe, dont le comportement n&#8217;est pas r√©gi par <em>jQuery</em> ou une autre biblioth√®que.</p>
</li>
<li>
<p>Cette fonction est responsable de l&#8217;affichage de donn√©es dans un √©l√©ment&#160;HTML.</p>
</li>
<li>
<p>Cette fois-ci, nous nous contentons de seulement mettre √† jour attributs et contenus&#160;‚Äì la logique m√©tier a √©t√© d√©plac√©e dans le module <code>timer.js</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le code a √©t√© divis√© en deux sections distinctes&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>celle qui d√©crit la r√©action √† une donn√©e&#160;;</p>
</li>
<li>
<p>celle qui int√®gre le minuteur avec les √©l√©ments du DOM.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nous n&#8217;avons pas r√©ellement besoin de savoir comment fonctionne le minuteur √†
ce niveau&#160;‚Äì nous devons pouvoir compter sur les donn√©es qu&#8217;il nous fournit.</p>
</div>
<div class="listingblock">
<div class="title">modules/timer.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const tick = () =&gt; {              <b class="conum">(1)</b>
  const now = new Date;

  return {                        <b class="conum">(2)</b>
    now,
    className: now.getSeconds() % 2 ? 'impair': 'pair'
  }
};

module.exports = function timer ({ onTick, interval }) {<b class="conum">(3)</b>
  setInterval(() =&gt; onTick(tick()), interval);          <b class="conum">(4)</b>

  return tick();                  <b class="conum">(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cette fonction (priv√©e) est charg√©e de d√©crire le temps pr√©sent sous forme d&#8217;une structure de donn√©es.</p>
</li>
<li>
<p>Cette structure de donn√©es pourra retourner de nouvelles cl√©s/valeurs sans remettre en cause le fonctionnement du code y ayant recours.</p>
</li>
<li>
<p>Le param√®tre <code>onTick</code> est une fonction pass√©e en argument qui sera appel√©e √† chaque nouvel intervalle de temps.</p>
</li>
<li>
<p>La responsabilit√© de <code>timer</code> est de communiquer une nouvelle structure de donn√©es √† un intervalle de temps donn√©.</p>
</li>
<li>
<p>On retourne imm√©diatement une structure de donn√©es par commodit√© et de mani√®re synchrone.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Pour un r√©sultat identique, nous avons d√©sormais s√©par√© notre code en trois
domaines distincts&#160;: le minuteur, son int√©gration, sa repr√©sentation sous forme HTML.
Cerise sur le g√¢teau, cette distinction se constate visuellement,
au premier coup&#160;d&#8217;≈ìil.</p>
</div>
<div class="paragraph">
<p>Tout n&#8217;est pas parfait, car nous sommes encore li√©s √† la structure du
document&#160;HTML.</p>
</div>
</div>
<div class="sect2">
<h3 id="partager_le_code_m√©tier_avecnode">4.3. Partager le code m√©tier avec&#160;Node</h3>
<div class="paragraph">
<p>Cette s√©paration de principes (<em>separation of concerns</em>) va au-del√† du plaisir
de l&#8217;esth√®te.
Nous venons sans le savoir de cr√©er du <strong>code ECMAScript universel</strong>.</p>
</div>
<div class="paragraph">
<p>Pourquoi universel&#160;?
Parce que nous pouvons tout aussi bien l&#8217;inclure et l&#8217;ex√©cuter dans Node que
dans un navigateur&#160;:</p>
</div>
<div class="listingblock">
<div class="title">modules/node-timer.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const timerFn = require('./timer.js');

timerFn({ interval: 1000, onTick: console.log });</code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;ex√©cution du script <code>node-timer.js</code> afficherait quelque chose comme ce
qui suit dans votre terminal&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node examples/modules/node-timer.js
{ now: 2017-02-17T11:07:29.752Z, className: 'impair' }
{ now: 2017-02-17T11:07:30.762Z, className: 'pair' }
{ now: 2017-02-17T11:07:31.768Z, className: 'impair' }
{ now: 2017-02-17T11:07:32.770Z, className: 'pair' }
{ now: 2017-02-17T11:07:33.775Z, className: 'impair' }
{ now: 2017-02-17T11:07:34.779Z, className: 'pair' }
<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque seconde, la fonction <code>console.log</code> est appel√©e et affiche la structure
de donn√©es de notre minuteur dans la sortie standard du terminal.</p>
</div>
<div class="paragraph">
<p>Nous pourrions d√®s √† pr√©sent utiliser le minuteur dans d&#8217;autres applications,
c√¥t√© client, c√¥t√© serveur et, pourquoi pas, un jour le publier sur le registre&#160;<code>npm</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="s√©paration_du_fond_et_de_la_forme_donn√©es_rendu_et_interactions">4.4. S√©paration du fond et de la forme : donn√©es, rendu et interactions</h3>
<div class="paragraph">
<p>Les praticien¬∑ne¬∑s de l&#8217;int√©gration web nous le dirons souvent&#160;: il faut
<strong>s√©parer le fond de la forme</strong>.
Il en est de m√™me dans notre code&#160;‚Äì et pas que pour le d√©veloppement <em>front-end</em>.</p>
</div>
<div class="paragraph">
<p>Un code maintenable n&#8217;a pas besoin d&#8217;√™tre complexe.
Il n√©cessite surtout de bien isoler ses p√©rim√®tres d&#8217;intervention.</p>
</div>
<div class="paragraph">
<p>Les exemples pr√©c√©dents nous ont permis de d√©celer trois p√©rim√®tres phares&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>donn√©es&#160;: des structures pr√©dictibles, obtenues ou modifi√©es&#160;;</p>
</li>
<li>
<p>rendu&#160;: la repr√©sentation des donn√©es en contexte, que ce soit une page HTML,
un terminal ou un fichier&#160;CSV&#160;;</p>
</li>
<li>
<p>interactions&#160;: des √©v√©nements d√©clench√©s par les utilisateurs, par des
facteurs externes ou des r√®gles m√©tier&#160;‚Äì ils affectent les donn√©es et leur
repr√©sentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="react">4.5. Rapprocher donn√©es, rendu et interactions avec&#160;React</h3>
<div class="paragraph">
<p><em>React</em> a atteint un pic de popularit√© certain en&#160;2015 et&#160;2016,
pas seulement parce qu&#8217;il s&#8217;agit d&#8217;un outil bien con√ßu, mais justement parce
qu&#8217;il encourage cette pratique de la repr√©sentation des donn√©es.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> API&#160;React</div>
<div class="paragraph">
<p>Les exemples suivants se basent sur la biblioth√®que <em>React</em> (<span class="URL"><a href="https://facebook.github.io/react/" class="bare">facebook.github.io/react/</a></span>).
Sa documentation offre de bons exemples pour se familiariser avec son utilisation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notre code HTML n&#8217;est qu&#8217;un r√©sultat exposant des surfaces d&#8217;interaction.
Il se structure en composants.
Un composant est responsable de deux choses&#160;: la repr√©sentation de donn√©es et
la r√©action √† des √©v√©nements.</p>
</div>
<div class="paragraph">
<p>Cela se traduira par un changement de taille&#160;: l&#8217;exemple que nous avons fait
√©voluer ne fait plus mention de balise <code>&lt;time&gt;</code> mais expose une balise d√©di√©e √†
contenir notre composant minuteur&#160;:</p>
</div>
<div class="listingblock">
<div class="title">modules/react-app.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;body&gt;
  &lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;

  &lt;div id="app"&gt;&lt;/div&gt;

  &lt;script src="react-app-browserify.js"&gt;&lt;/script&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notre code applicatif est r√©duit √† son plus strict minimum&#160;:</p>
</div>
<div class="listingblock">
<div class="title">modules/react-app.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import { createElement } from 'react';
import ReactDOM from 'react-dom';
import DateInterval from './date-interval.jsx';

ReactDOM.render(                                  <b class="conum">(1)</b>
  createElement(DateInterval, {interval: 1000}),  <b class="conum">(2)</b>
  document.querySelector('#app')                  <b class="conum">(3)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>M√©thode responsable du rendu HTML de notre composant <code>TimeInterval</code> dans l&#8217;√©l√©ment <code>&lt;div id="app"&gt;</code>.</p>
</li>
<li>
<p>Cr√©ation de notre composant minuteur avec un intervalle de mise √† jour de 1&#160;000 millisecondes.</p>
</li>
<li>
<p>Indication que le rendu du composant sera effectu√© dans l&#8217;√©l√©ment <code>&lt;div id="app"&gt;</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Cela ressemble fortement au contenu de nos pr√©c√©dentes invocations de
<code>$(document).ready()</code> mais sans avoir √† se soucier du fonctionnement interne du minuteur.</p>
</div>
<div class="paragraph">
<p>La repr√©sentation et le fonctionnement du minuteur sont d√©sormais regroup√©s
dans un seul composant&#160;:</p>
</div>
<div class="listingblock">
<div class="title">modules/date-interval.jsx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-jsx hljs" data-lang="jsx">import React, { Component } from 'react';
import timerFn from './timer.js';

export default class DateInterval extends Component {    <b class="conum">(1)</b>
  constructor(props) {                                   <b class="conum">(2)</b>
    super(props);

    const {interval} = props;
    this.onTick = this.onTick.bind(this);

    this.state = {
      tickData: timerFn({ interval, onTick: this.onTick })<b class="conum">(3)</b>
    };
  }

  onTick (tickData) {
    this.setState({ tickData });                   <b class="conum">(4)</b>
  }

  render() {                                       <b class="conum">(5)</b>
    const {className, now} = this.state.tickData;  <b class="conum">(6)</b>

    return (&lt;time className={className} dateTime={now.toISOString()}&gt;
      {now.toLocaleTimeString()}
    &lt;/time&gt;);
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous exportons un composant <em>React</em> gr√¢ce √† l&#8217;op√©rateur <code>extends</code> (<a href="../chapter-03/index.html#primitive-class">chapitre&#160;3</a>).</p>
</li>
<li>
<p>Le <code>constructor</code> est ex√©cut√© quand le composant est rendu dans le document.</p>
</li>
<li>
<p>La propri√©t√© <code>interval</code> nous est fournie dans <code>react-app.js</code> et nous stockons la structure de donn√©e retourn√©e par le minuteur tout en d√©clenchant son actualisation toutes les 1&#160;000 millisecondes.</p>
</li>
<li>
<p>√Ä chaque intervalle, nous mettons √† jour la valeur <code>tickData</code> de l&#8217;√©tat interne du composant (<code>this.state</code>).</p>
</li>
<li>
<p>La m√©thode <code>render()</code> est ex√©cut√©e quand le composant est ins√©r√© dans un document pour la premi√®re fois et quand l&#8217;√©tat interne (<code>this.state</code>) change.</p>
</li>
<li>
<p>Nous d√©structurons la valeur connue de <code>tickData</code> pour effectuer une op√©ration qui nous rappelle les diff√©rents appels √† <code>.attr('class')</code> et <code>.text()</code> de <em>jQuery</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>React</em> introduit trois concepts au sein des composants&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un cycle de vie bas√© sur des propri√©t√©s (<em>props</em>) et un √©tat interne (<em>state</em>)&#160;;</p>
</li>
<li>
<p>des propri√©t√©s immuables pour le param√©trage initial&#160;;</p>
</li>
<li>
<p>un √©tat interne mutable pour contenir les changements et demander une
actualisation de leur repr√©sentation dans le document.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>React</em> d√©termine les op√©rations √† effectuer dans le document HTML en fonction
de leur lourdeur&#160;: (re)cr√©ation compl√®te de <code>&lt;time&gt;</code> dans le n≈ìud
parent, simple mise √† jour d&#8217;un ou plusieurs attribut(s) ou encore d√©placement
du composant ailleurs dans le document HTML, etc.</p>
</div>
<div class="paragraph">
<p>L&#8217;intelligence d&#8217;une biblioth√®que comme <em>React</em> est d&#8217;encourager √† d√©crire
les donn√©es et leur rendu pour se charger des op√©rations d&#8217;√©criture dans le DOM.
Cela conduit √† cr√©er des composants faciles √† isoler, √† r√©utiliser et √† tester.</p>
</div>
<div class="paragraph">
<p>Cette approche nous a laiss√©s r√©utiliser notre minuteur simplement en l&#8217;adaptant.
<em>React</em> nous permet de diriger l&#8217;affichage du document plut√¥t que d&#8217;en d√©pendre.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Outil</span> React Developer Tools</div>
<div class="paragraph">
<p>Une extension pour les navigateurs Chrome et Firefox d√©taille l&#8217;arborescence
des composants mont√©s dans le document HTML ainsi qu&#8217;une vue de leurs propri√©t√©s
respectives&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://chrome.google.com/webstore/detail/fmkadmapgofadopljbjfkapdkoienihi" class="bare">chrome.google.com/webstore/detail/fmkadmapgofadopljbjfkapdkoienihi</a></span></p>
</li>
<li>
<p><span class="URL"><a href="https://addons.mozilla.org/firefox/addon/react-devtools/" class="bare">addons.mozilla.org/firefox/addon/react-devtools/</a></span></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/react-devtools.png" alt="react devtools" width="85%">
</div>
<div class="title">Figure 3. React Developer Tools</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="io">5. Des requ√™tes Ajax au temps&#160;r√©el</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les technologies web offrent un panel de fonctionnalit√©s cr√©atives et adaptables.
L&#8217;explosion du <em>Web 2.0</em> a co√Øncid√© avec la red√©couverte de <code>XMLHttpRequest</code>,
une API initialement cr√©√©e par Microsoft pour transf√©rer des donn√©es entre
client et serveur, de mani√®re non&#160;bloquante.
Cette fonctionnalit√© a permis de basculer vers un monde de pages dynamiques et
rapides √† charger.
Des applications web comme Google&#160;Maps, Gmail ou la recherche instantan√©e de
Google ont parachev√© la popularisation de cette technique.</p>
</div>
<div class="paragraph">
<p>Toutefois, son API est peu intuitive et est unidirectionnelle, dirig√©e
du client vers le serveur.
Le terme <code>XMLHttpRequest</code> est parfois nomm√© <code>Ajax</code> ou <code>xhr</code>.</p>
</div>
<div class="paragraph">
<p>Un m√™me exemple c√¥t√© client sera d√©velopp√© et successivement adapt√© aux
technologies <code>fetch()</code>, <em>EventSource</em> puis <em>WebSocket</em>.
Il nous permettra d&#8217;en faire √©merger les principes, leurs cas d&#8217;usage ainsi
que leur possible int√©gration avec&#160;Node.</p>
</div>
<div class="paragraph">
<p>L&#8217;impl√©mentation c√¥t√© serveur est bas√©e sur un serveur
<a href="../chapter-07/index.html#express">Express.js</a> dont l&#8217;usage est expliqu√© au
<a href="../chapter-07/index.html">chapitre&#160;7</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/io-example.png" alt="io example" width="85%">
</div>
<div class="title">Figure 4. R√©sultat attendu dans les exemples des sections suivantes</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Remarque</span> Node, mais pas&#160;que.</div>
<div class="paragraph">
<p><code>fetch()</code>, <em>EventSource</em> et <em>WebSocket</em> reposent sur le protocole HTTP/1 et ses extensions.
Il est important de comprendre que leur contrepartie &#8220;c√¥t√© serveur&#8221; existe aussi
dans d&#8217;autres langages et environnements comme Ruby, Python et PHP.</p>
</div>
<div class="paragraph">
<p>Il se trouve que la nature asynchrone m√™me de Node rend cette int√©gration
relativement ais√©e et triviale, aussi et en grande partie gr√¢ce √† l&#8217;√©cosyst√®me&#160;<code>npm</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="io-fetch">5.1. √âchange ponctuel de donn√©es avec <code>fetch()</code></h3>
<div class="paragraph">
<p><code>fetch()</code> offre une interface tr√®s simple pour appeler une ressource HTTP.
Le r√©sultat est retourn√© sous forme de promesse
(<a href="../chapter-03/index.html#promise">chapitre&#160;3</a>).
Cette fonction sert aussi bien √† obtenir des ressources avec des requ√™tes de
type&#160;<code>GET</code> et <code>HEAD</code> qu&#8217;√† en cr√©er et modifier avec des requ√™tes de type <code>POST</code>,
<code>PUT</code>, <code>DELETE</code> et <code>PATCH</code>.</p>
</div>
<div class="paragraph">
<p>L&#8217;exemple associ√© est accessible sur <span class="URL"><a href="http://localhost:4000/examples/io/fetch.html" class="bare">localhost:4000/examples/io/fetch.html</a></span>.
Nous pouvons v√©rifier la compatibilit√© navigateur de <code>fetch()</code> sur
<span class="URL"><a href="http://caniuse.com#feat=fetch" class="bare">caniuse.com#feat=fetch</a></span>.</p>
</div>
<div class="paragraph">
<p>Le d√©roul√© d&#8217;ex√©cution d&#8217;un appel √† <code>fetch()</code> est le suivant&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Construction de la requ√™te (URL ou objet <code>Request</code>, options).</p>
</li>
<li>
<p>R√©ception des en-t√™tes de la r√©ponse (objet <code>Response</code>).</p>
</li>
<li>
<p>D√©codage de la r√©ponse.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Plusieurs d√©codeurs de r√©ponse sont fournis nativement&#160;: texte
(<code>response.text()</code>), JSON (<code>response.json()</code>), ArrayBuffer
(<code>response.arrayBuffer()</code>), Blob (<code>response.blob()</code>) et FormData
(<code>response.formData()</code>).</p>
</div>
<div class="listingblock">
<div class="title">io/fetch-client.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const userList = document.querySelector('#user-list');

setInterval(() =&gt; {
  fetch('/new-users')                             <b class="conum">(1)</b>
    .then(response =&gt; response.text())            <b class="conum">(2)</b>
    .then(data =&gt; {                               <b class="conum">(3)</b>
      const now = new Date().toLocaleTimeString();
      const li = document.createElement('li');

      li.textContent = `${now} : ${data}`;
      userList.prepend(li);
    })
}, 2000);</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ex√©cution de la requ√™te HTTP <em>GET</em> vers <code>/new-users</code> depuis le navigateur courant.</p>
</li>
<li>
<p>D√©codage progressif de la r√©ponse.</p>
</li>
<li>
<p>Une fois le d√©codage termin√©, le r√©sultat de la requ√™te HTTP est mis √† disposition&#160;‚Äì ici, sous forme de cha√Æne de caract√®res.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/fetch-frames.png" alt="fetch frames" width="85%">
</div>
<div class="title">Figure 5. Traces r√©seau d&#8217;appels successifs √† <code>fetch()</code> ; chacun r√©sultant en une nouvelle requ√™te&#160;HTTP</div>
</div>
<div class="paragraph">
<p>L&#8217;impl√©mentation d&#8217;une ressource HTTP c√¥t√© serveur s&#8217;effectue simplement
en retournant une r√©ponse lors d&#8217;une requ√™te&#160;:</p>
</div>
<div class="listingblock">
<div class="title">io/fetch-server.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const chance = require('chance').Chance();

module.exports = (app) =&gt; {
  app.get('/new-users', (req, res) =&gt; {
    res.send(chance.name());
  });
};</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Guide</span> Collection d&#8217;exemples</div>
<div class="paragraph">
<p>Le site communautaire MDN met √† disposition une dizaine d&#8217;exemples
pour illustrer diff√©rents cas d&#8217;utilisation de <code>fetch()</code>&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://github.com/mdn/fetch-examples" class="bare">github.com/mdn/fetch-examples</a></span></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En r√©sum√©, <code>fetch()</code> est id√©al pour des demandes ponctuelles de donn√©es,
du client vers le serveur.
Le module&#160;<code>npm</code> <code>node-fetch</code> (<span class="URL"><a href="https://npmjs.com/node-fetch" class="bare">npmjs.com/node-fetch</a></span>) est une
impl√©mentation de <code>fetch()</code> pour Node, tandis que <code>whatwg-fetch</code>
(<span class="URL"><a href="https://npmjs.com/whatwg-fetch" class="bare">npmjs.com/whatwg-fetch</a></span>) s&#8217;occupe uniquement de <em>polyfiller</em> les
navigateurs.</p>
</div>
</div>
<div class="sect2">
<h3 id="io-eventsource">5.2. Approche unidirectionnelle avec EventSource</h3>
<div class="paragraph">
<p><em>EventSource</em> est un m√©canisme moins connu que <code>fetch()</code> ou <em>WebSocket</em> mais
tire ses origines de la technologie <em>Comet</em>.
On peut l&#8217;assimiler √† une inversion de <code>fetch()</code>&#160;: le client appelle une ressource
serveur, maintient une connexion de longue dur√©e et attend un ou plusieurs
message(s) dudit serveur.</p>
</div>
<div class="paragraph">
<p>Chaque connexion est ouverte en faisant appel √† la construction d&#8217;un objet
<code>EventSource</code>, qui √©met alors plusieurs types d&#8217;√©v√©nements en fonction des actions&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>open</code>&#160;: lorsque le client s&#8217;est connect√© au serveur&#160;;</p>
</li>
<li>
<p><code>message</code>&#160;: lorsque le serveur √©met des donn√©es √† destination du client&#160;;</p>
</li>
<li>
<p><code>close</code>&#160;: lorsque la connexion est ferm√©e par le serveur&#160;;</p>
</li>
<li>
<p><code>error</code>&#160;: lorsque la connexion est accidentellement interrompue.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce mod√®le de connexion permet tout aussi bien d&#8217;avoir un canal de donn√©es
unique avec chaque utilisateur ou encore d&#8217;√©mettre les m√™mes donn√©es en temps
r√©el √† destination de tous les usagers.</p>
</div>
<div class="paragraph">
<p>L‚Äôexemple associ√© est accessible sur <span class="URL"><a href="http://localhost:4000/examples/io/eventsource.html" class="bare">localhost:4000/examples/io/eventsource.html</a></span>.
Nous pouvons v√©rifier la compatibilit√© navigateur de <em>EventSource</em> sur
<span class="URL"><a href="http://caniuse.com#feat=eventsource" class="bare">caniuse.com#feat=eventsource</a></span>.</p>
</div>
<div class="listingblock">
<div class="title">io/eventsource-client.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const connection = new EventSource('/new-users');     <b class="conum">(1)</b>
const userList = document.querySelector('#user-list');

connection.addEventListener('message', ({data}) =&gt; {  <b class="conum">(2)</b>
  const now = new Date().toLocaleTimeString();
  const li = document.createElement('li');

  li.textContent = `${now} : ${data}`;
  userList.prepend(li);
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous ouvrons une nouvelle connexion <em>EventSource</em> de longue dur√©e depuis
le navigateur courant.</p>
</li>
<li>
<p>Fonction appel√©e √† chaque fois que le serveur transmet un message au client.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/eventsource-frames.png" alt="eventsource frames" width="85%">
</div>
<div class="title">Figure 6. Plusieurs messages peuvent √™tre transmis par le biais d&#8217;une seule connexion HTTP avec <em>EventSource</em></div>
</div>
<div class="paragraph">
<p>L&#8217;impl√©mentation d'<em>EventSource</em> demande un peu d&#8217;efforts c√¥t√© serveur, mais ne
n√©cessite pas de <em>framework</em> particulier.
La complexit√© r√©side dans le maintien d&#8217;une transmission de donn√©es d√©di√©e √†
chaque client ainsi qu&#8217;√† la lib√©ration de la connexion lorsque le client se d√©connecte.</p>
</div>
<div class="listingblock">
<div class="title">io/eventsource-server.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const WebSocket = require('faye-websocket');
const {EventSource} = WebSocket;

const chance = require('chance').Chance();

module.exports = (app) =&gt; {
  app.get('/new-users', (req, res, next) =&gt; {
    if (!EventSource.isEventSource(req)) {      <b class="conum">(1)</b>
      return next();
    }

    let es = new EventSource(req, res);         <b class="conum">(2)</b>
    const loop = setInterval(() =&gt; {
      es.send(chance.name());                   <b class="conum">(3)</b>
    }, 2000);

    es.on('close', () =&gt; {
      clearInterval(loop);
      es = null;
      next();
    });
  });
};</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Une connexion <em>EventSource</em> s&#8217;effectue (presque) comme une requ√™te HTTP classique&#160;‚Äì il convient de v√©rifier qu&#8217;elle s&#8217;annonce en tant que&#160;telle.</p>
</li>
<li>
<p>Cr√©ation d&#8217;un canal unique entre le client et le serveur.</p>
</li>
<li>
<p>Chaque appel √† <code>es.send</code> enverra un nouveau message au client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le serveur est responsable de la gestion des connexions demand√©es par les
diff√©rents clients.</p>
</div>
<div class="admonitionblock note info">
<table>
<tr>
<td class="icon">
<div class="title">üìñ</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> EventSource</div>

Rendez-vous sur <em>MDN web docs</em> pour en savoir plus sur EventSource.<br>
<a href="https://developer.mozilla.org/docs/fr/Server-sent_events" class="bare URL" target="_blank" rel="noopener">developer.mozilla.org/docs/fr/Server-sent_events</a>

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En r√©sum√©, <em>EventSource</em> est id√©al pour maintenir une connexion avec le serveur
et souscrire √† des mises √† jour en continu.
Chaque connexion <em>EventSource</em> devrait concerner qu&#8217;un seul et m√™me type d&#8217;√©v√©nement.</p>
</div>
</div>
<div class="sect2">
<h3 id="io-websocket">5.3. √âchanges en temps&#160;r√©el avec <em>WebSocket</em></h3>
<div class="paragraph">
<p><em>WebSocket</em> est une technologie web favorisant les √©changes bidirectionnels
entre client et serveur.</p>
</div>
<div class="paragraph">
<p>√Ä l&#8217;inverse du protocole HTTP/1, tout message envoy√© par le client ou par le
serveur n&#8217;appelle pas √† une r√©ponse de la part du receveur.
Cet √©l√©ment et le maintien d&#8217;une connexion permanente expliquent la
rapidit√© du protocole en comparaison avec le mod√®le requ√™te/r√©ponse.</p>
</div>
<div class="paragraph">
<p>L‚Äôexemple associ√© est accessible sur <span class="URL"><a href="http://localhost:4000/examples/io/websocket.html" class="bare">localhost:4000/examples/io/websocket.html</a></span>.
Nous pouvons v√©rifier la compatibilit√© navigateur de <em>WebSocket</em> sur
<span class="URL"><a href="http://caniuse.com#feat=websocket" class="bare">caniuse.com#feat=websocket</a></span>.</p>
</div>
<div class="listingblock">
<div class="title">io/websocket-client.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">let ws = new WebSocket('ws://localhost:4000/users');  <b class="conum">(1)</b>
const userList = document.querySelector('#user-list');
let interval;

ws.addEventListener('open', () =&gt; {
  interval = setInterval(() =&gt; {
    ws.send(JSON.stringify({ action: 'getName' }));   <b class="conum">(2)</b>
  }, 2000);
});

ws.addEventListener('message', ({data}) =&gt; {          <b class="conum">(3)</b>
  const li = document.createElement('li');
  const now = new Date().toLocaleTimeString();

  li.textContent = `${now} : ${data}`;
  userList.prepend(li);
});

ws.addEventListener('close', () =&gt; {
  ws = null;
  clearInterval(interval);
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous ouvrons une connexion <em>WebSocket</em> depuis le navigateur courant.</p>
</li>
<li>
<p>√âmission d&#8217;un message √† destination du serveur.</p>
</li>
<li>
<p>R√©action √† un message √©mis par le serveur.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/websocket-frames.png" alt="websocket frames" width="85%">
</div>
<div class="title">Figure 7. Trame de messages envoy√©s par le client (sur fond vert) et par le serveur</div>
</div>
<div class="paragraph">
<p>L&#8217;impl√©mentation c√¥t√© serveur est l√©g√®rement plus compliqu√©e qu&#8217;avec
<em>EventSource</em> pour la simple et bonne raison que <em>Websocket</em> est une surcouche
du protocole&#160;<code>ws</code>.
HTTP n&#8217;est utilis√© que comme canal de communication pour √©tablir un lien avec
le serveur&#160;<code>ws</code>.
HTTP sert de tunnel tandis que le dialogue entre client et serveur s&#8217;effectue
dans un dialecte compr√©hensible uniquement de clients <em>WebSocket</em>.</p>
</div>
<div class="paragraph">
<p>Il est n√©cessaire d&#8217;utiliser un module&#160;<code>npm</code> <em>WebSocket</em> comme <em>faye</em>
(<span class="URL"><a href="https://npmjs.com/faye-websocket" class="bare">npmjs.com/faye-websocket</a></span>) ou <em>socket.io</em>
(<span class="URL"><a href="https://npmjs.com/socket.io" class="bare">npmjs.com/socket.io</a></span>) √† moins de vouloir r√©impl√©menter le protocole
soi-m√™me.
Le motif de conception est similaire √† celui d'<em>EventSource</em>, √† la diff√©rence pr√®s
qu&#8217;il faut aussi √©couter les messages transmis par le client.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Remarque</span> HTTP et le statut 101 Switching Protocols</div>
<div class="paragraph">
<p>Voici ce qui se passe lorsqu&#8217;un client <em>WebSocket</em> se connecte sur <code>ws://example.com</code>&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Requ√™te HTTP <code><a href="http://example.com" class="bare">example.com</a></code> standard contenant les en-t√™tes <code>Upgrade: websocket</code> et <code>Connection: Upgrade</code>.</p>
</li>
<li>
<p>Le serveur HTTP r√©pond avec un statut <code>101 Switching Protocols</code>.</p>
</li>
<li>
<p>Le serveur <em>WebSocket</em> prend le relais dans le dialogue client/serveur.</p>
</li>
<li>
<p>Client et serveur communiquent d√©sormais via le protocole <code>ws</code> au sein de la connexion HTTP initiale.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Par extension et de par la nature m√™me du protocole <code>ws</code>, il serait tout √†
fait possible que <em>et</em> clients <em>et</em> serveur soient des agents Node.
Autrement dit, un client <em>WebSocket</em> n&#8217;a pas n√©cessairement √† √™tre un navigateur.</p>
</div>
<div class="listingblock">
<div class="title">io/websocket-server.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const WebSocket = require('faye-websocket');
const chance = require('chance').Chance();

module.exports = (server) =&gt; {
  server.on('upgrade', (req, socket, body, next) =&gt; {  <b class="conum">(1)</b>
    if (!WebSocket.isWebSocket(req)) {           <b class="conum">(2)</b>
      return next();
    }

    let ws = new WebSocket(req, socket, body);   <b class="conum">(3)</b>

    ws.on('message', event =&gt; {                  <b class="conum">(4)</b>
      const data = JSON.parse(event.data);

      if (data.action === 'getName') {
        ws.send(chance.name());                  <b class="conum">(5)</b>
      }
    });

    ws.on('close', () =&gt; {
      ws = null;
    });
  });
};</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le serveur HTTP vient de r√©pondre avec un statut <code>101 Switching Protocols</code> et d√©l√®gue d√©sormais la responsabilit√© du dialogue client/serveur.</p>
</li>
<li>
<p>Nous v√©rifions que le changement de protocole concerne le protocole <code>ws</code>.</p>
</li>
<li>
<p>La connexion r√©seau (<code>socket</code>) est transmise au serveur <em>WebSocket</em> pour amorcer le dialogue client/serveur avec le protocole <code>ws</code>.</p>
</li>
<li>
<p>R√©action √† la r√©ception d&#8217;un message client.</p>
</li>
<li>
<p>√âmission d&#8217;un message √† destination d&#8217;un client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L√† aussi, le serveur est responsable de la gestion des connexions demand√©es par
les diff√©rents clients.</p>
</div>
<div class="admonitionblock note info">
<table>
<tr>
<td class="icon">
<div class="title">üìñ</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> WebSockets</div>

Rendez-vous sur <em>MDN web docs</em> pour en savoir plus sur WebSockets.<br>
<a href="https://developer.mozilla.org/docs/fr/WebSockets" class="bare URL" target="_blank" rel="noopener">developer.mozilla.org/docs/fr/WebSockets</a>

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En r√©sum√©, <em>WebSocket</em> est id√©al pour maintenir une connexion en temps&#160;r√©el et
pour relayer plusieurs messages √† l&#8217;initiative du serveur et de tout client
connect√©&#160;‚Äì qu&#8217;il s&#8217;agisse d&#8217;un navigateur ou d&#8217;un agent Node.
Chaque connexion <em>WebSocket</em> peut encapsuler plusieurs types de messages.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="d√©velopper_au_quotidien">6. D√©velopper au quotidien</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous avons beaucoup parl√© de nouvelles techniques et de modularisation.
Cela peut sembler rebutant, notamment par l&#8217;introduction d&#8217;outils auxquels
nous ne sommes pas encore familiers.</p>
</div>
<div class="paragraph">
<p>L&#8217;√©cosyst√®me Node fournit √©norm√©ment d&#8217;outils qui devraient nous faire
gagner du temps, en nous aidant √† organiser notre travail ou √† ex√©cuter des actions
lorsqu&#8217;un fichier est modifi√©, mais aussi en actualisant automatiquement
notre application web au fil du d√©veloppement
(fini les appuis r√©p√©t√©s sur la touche&#160;<kbd>F5</kbd>) ou encore en
optimisant nos fichiers graphiques.</p>
</div>
<div class="sect2">
<h3 id="watchify">6.1. Reconstruire en continu avec <code>watchify</code></h3>
<div class="paragraph">
<p>L&#8217;utilisation de <a href="#browserify">browserify</a> nous apporte du confort avec la
possibilit√© d&#8217;inclure des modules&#160;<code>npm</code> dans les navigateurs.
En revanche, cela nous demande de g√©n√©rer des artefacts&#160;‚Äì des <em>bundles</em>&#160;‚Äì √†
chaque modification pour consolider ces changements.</p>
</div>
<div class="paragraph">
<p>C&#8217;est √† ce moment qu&#8217;intervient le module <em>watchify</em> (<span class="URL"><a href="https://npmjs.com/watchify" class="bare">npmjs.com/watchify</a></span>).
Il fonctionne exactement comme <em>browserify</em>, mais au lieu de compiler une seule
fois, il compile d√®s qu&#8217;un changement est d√©tect√©&#160;‚Äì o√π que ce soit dans l&#8217;arbre
de d√©pendances du point d&#8217;entr√©e (param√®tre&#160;<code>-e</code>, <code>--entrypoint</code>).</p>
</div>
<div class="paragraph">
<p>La commande suivante compilerait le fichier <code>examples/modules/react-app.js</code>
une seule fois&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/browserify -t babelify \
  -e examples/modules/react-app.js \
  -o examples/modules/react-app-browserify.js</pre>
</div>
</div>
<div class="paragraph">
<p>Il suffit de remplacer <code>browserify</code> par <code>watchify</code>&#160;‚Äì le programme garde la main
et indique chaque nouvelle compilation sur une nouvelle ligne&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/watchify -dv -t babelify \
  -e examples/modules/react-app.js \
  -o examples/modules/react-app-browserify.js
1840601 bytes written to react-app-browserify.js (2.58 seconds) at 4:44:28 PM
352482 bytes written to react-app-browserify.js (0.10 seconds) at 4:45:09 PM
1840605 bytes written to react-app-browserify.js (0.25 seconds) at 4:45:15 PM</pre>
</div>
</div>
<div class="paragraph">
<p><em>watchify</em> utilise un m√©canisme dit de <strong>compilation incr√©mentale</strong>&#160;: il ne
recompile pas tout, mais uniquement les diff√©rences depuis le dernier changement.
C&#8217;est beaucoup plus rapide et tout aussi efficace.</p>
</div>
<div class="paragraph">
<p>Trois arguments sont utiles √† <em>watchify</em>&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-v</code>&#160;(<code>--verbose</code>)&#160;: force la cr√©ation du fichier compil√© au lancement de la commande.</p>
</li>
<li>
<p><code>-o</code>&#160;(<code>--outfile</code>)&#160;: sp√©cifie le chemin d&#8217;enregistrement du fichier compil√©&#160;‚Äì il est impossible d&#8217;utiliser la <a href="../chapter-04/index.html#stdio">sortie standard</a> (<a href="../chapter-04/index.html">chapitre&#160;4</a>).</p>
</li>
<li>
<p><code>-d</code>&#160;(<code>--debug</code>)&#160;: (lire &#8220;<a href="#browserify-sourcemaps">Source&#160;Maps</a>&#8221; dans ce m√™me chapitre).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="livereload">6.2. Changements en temps&#160;r√©el dans le navigateur</h3>
<div class="paragraph">
<p>Modifier un fichier. Changer de fen√™tre. Recharger. Changer de fen√™tre. Re-modifier
un fichier. Changer de fen√™tre. Recharger. L√† c&#8217;est bon.</p>
</div>
<div class="paragraph">
<p>La quantit√© d&#8217;outils √† disposition et leurs diff√©rentes opinions sur notre mani√®re
de travailler nous obligent √† prendre des postures de travail qui ne vont
pas n√©cessairement dans le sens de la productivit√©.</p>
</div>
<div class="paragraph">
<p>L&#8217;int√©gration de Node avec le syst√®me d&#8217;exploitation va nous aider √† d√©clencher
des actions lorsque des fichiers sont modifi√©s.
Ces modifications sont parfois de notre fait, directement ou par le biais d&#8217;un
autre logiciel (un optimiseur d&#8217;images ou la <a href="#node-sass">compilation d&#8217;un fichier Sass</a> par exemple).</p>
</div>
<div class="paragraph">
<p>Nous allons explorer deux strat√©gies d&#8217;actualisation&#160;: le rafra√Æchissement
automatique du navigateur et le remplacement de modules √† chaud
(<em>Hot Module Replacement</em>, HMR).</p>
</div>
<div class="paragraph">
<p><em>browser-sync</em> est un outil formidable de d√©veloppement pour
rafra√Æchir automatiquement une page web si son contenu ou une des ressources
associ√©es change.
Il offre √©galement la possibilit√© de propager les changements sur plusieurs
fen√™tres et terminaux&#160;‚Äì y compris les clics, d√©filements et toute interaction
avec des formulaires.</p>
</div>
<div class="videoblock">
<div class="title">Exemple de synchronisation d&#8217;affichage et de contenus entre deux fen√™tres avec <em>browser-sync</em></div>
<div class="content">
<video src="./videos/browser-sync.mp4" width="70%" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p><em>browser-sync</em> maintient la position du curseur de d√©filement lors d&#8217;un rechargement de contenu.
L&#8217;outil se lance soit de mani√®re autonome, soit en <em>proxy</em> entre l&#8217;utilisateur
et tout autre serveur web.
Il ne n√©cessite pas non plus de <em>plug-in</em> ou d&#8217;extension navigateur pour fonctionner,
ce qui le rend id√©al pour du prototypage, de la recherche utilisateur ou du
d√©veloppement local.</p>
</div>
<div class="listingblock">
<div class="title">Lancement d&#8217;un serveur web autonome avec synchronisation sur le port&#160;4000</div>
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/browser-sync start --server --port 4000 .</pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;exemple suivant illustre l&#8217;int√©gration de <em>browser-sync</em> avec le serveur
web exposant les exemples de ce chapitre (voir le d√©tail dans le fichier <code>server.js</code>)&#160;:</p>
</div>
<div class="listingblock">
<div class="title">livereload/server-sync.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const browserSync = require('browser-sync');

module.exports = (server) =&gt; {             <b class="conum">(1)</b>
  return port =&gt; {                         <b class="conum">(2)</b>
    const PUBLIC_PORT = 4000;              <b class="conum">(3)</b>
    const bs = browserSync.create();

    server.listen(port);                   <b class="conum">(4)</b>

    bs.init({                              <b class="conum">(5)</b>
      files: ['./examples'],
      port: PUBLIC_PORT,
      open: false,
      logPrefix: 'nodebook',
      proxy: {
        target: `http://localhost:${port}`,<b class="conum">(6)</b>
        ws: true,
      }
    });
  };
};</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>On passe un serveur&#160;HTTP en argument (obtenu via <code>http.createServer()</code> par exemple).</p>
</li>
<li>
<p>Ce port sera affect√© au serveur web mais ne sera pas vou√© √† √™tre public.</p>
</li>
<li>
<p>Ce port, lui, sera public.</p>
</li>
<li>
<p>D√©marrage du serveur web sur le port priv√©.</p>
</li>
<li>
<p>Initialisation de <em>browser-sync</em>.</p>
</li>
<li>
<p>Interfa√ßage avec le serveur web cr√©√© au point&#160;4.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>La synchronisation peut √™tre activ√©e avec tous les exemples du chapitre en
suffixant la commande <code>npm start</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>cd $(nodebook dir chapter-09)
<span data-bash-subs="$"></span>npm start -- --with-sync</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> <em>browser-sync</em></div>
<div class="paragraph">
<p><em>browser-sync</em> (<span class="URL"><a href="https://browsersync.io" class="bare">browsersync.io</a></span>) est richement document√© et
illustr√©, y&#160;compris ses int√©grations avec les outils Gulp et Grunt.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>browser-sync</em> a beau maintenir la position du d√©filement, il n&#8217;en reste pas
moins que chaque changement remet √† z√©ro l&#8217;espace m√©moire de la page.
C&#8217;est l√† qu&#8217;entre en jeu le remplacement des modules √† chaud.</p>
</div>
<div class="paragraph">
<p>Le <strong>remplacement des modules √† chaud</strong> (<em>Hot Module Replacement</em> ou HMR) est
une technique bas√©e sur le remplacement de fonctions ou d&#8217;objets tout en assurant
le maintien de leurs variables ou √©tats internes.
Cette technique a notamment √©t√© popularis√©e par la combinaison de la biblioth√®que
<em>React</em> et de l&#8217;outil d&#8217;assemblage <em>Webpack</em>.
Il est toutefois possible de proc√©der √† du remplacement √† chaud sans <em>React</em>
et sans <em>Webpack</em>.</p>
</div>
<div class="paragraph">
<p>Quatre actions sont effectu√©es&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un serveur de remplacement √† chaud est d√©marr√© localement.</p>
</li>
<li>
<p>L&#8217;outil d&#8217;assemblage (<em>browserify</em>, <em>Webpack</em>, etc.) ins√®re du code client
pour √©tablir un lien entre la page web et le serveur de remplacement √† chaud.</p>
</li>
<li>
<p>L&#8217;outil d&#8217;assemblage d√©clare les fichiers modifi√©s, transmis par le serveur
de remplacement √† chaud vers le navigateur.</p>
</li>
<li>
<p>Le code client remplace les modules et maintient leur √©tat interne.</p>
</li>
</ul>
</div>
<div class="videoblock">
<div class="title">Exemple de rechargement √† chaud avec des composants <em>React</em></div>
<div class="content">
<video src="./videos/react-hmr.mp4" width="70%" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>Le <em>plug-in browserify</em> nomm√© <em>livereactload</em> (<span class="URL"><a href="https://npmjs.com/livereactload" class="bare">npmjs.com/livereactload</a></span>)
est tr√®s certainement le plus facile √† mettre en place pour remplacer des
modules <em>React</em> √† la vol√©e.
Il n√©cessite une ligne de configuration c√¥t√© <em>browserify</em> mais aucun
changement de code c√¥t√© client.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> livereactload</div>
<div class="paragraph">
<p>Des aides √† l&#8217;installation du module <em>livereactload</em> sont disponibles dans
son fichier README.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le remplacement √† chaud n&#8217;est possible que lorsque nous sommes dans un √©tat
de reconstruction en continu, par exemple avec <a href="#watchify">watchify</a>.</p>
</div>
<div class="paragraph">
<p>Nous pouvons constater les effets du remplacement √† chaud avec un des exemples
de ce chapitre, accessible sur <span class="URL"><a href="http://localhost:4000/examples/livereload/react-app-hmr.html" class="bare">localhost:4000/examples/livereload/react-app-hmr.html</a></span>.
La commande <code>npm run watch</code> de ce chapitre d√©marre un serveur web et reconstruit
en continu le fichier <code>./examples/livereload/react-app-hmr.js</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>cd $(nodebook dir chapter-09)
<span data-bash-subs="$"></span>npm run watch</pre>
</div>
</div>
<div class="paragraph">
<p>Qui n&#8217;est autre qu&#8217;un √©quivalent de&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/watchify -dv \
  -t babelify \
  -p livereactload \
  -e ./examples/livereload/react-app-hmr.js \
  -o ./examples/livereload/react-app-hmr-browserify.js</pre>
</div>
</div>
<div class="paragraph">
<p>Dans cet exemple, le <em>transform</em>&#160;(<code>-t</code>) modifie le code source √† la vol√©e&#160;‚Äì
ici, pour adapter le code √©crit dans une syntaxe compr√©hensible par la majorit√©
des navigateurs gr√¢ce √† l&#8217;outil <a href="#transpilation">Babel</a>.</p>
</div>
<div class="paragraph">
<p>Le <em>plug-in</em>&#160;(<code>-p</code>) ne transforme pas le code mais le fonctionnement de
<em>watchify</em> pour y ajouter des fonctionnalit√©s&#160;‚Äì ici, refl√©ter les
changements du fichier source vers le navigateur en temps r√©el.</p>
</div>
<div class="paragraph">
<p>Il faudra ensuite modifier l&#8217;un des deux fichiers suivants&#160;‚Äì en d√©commentant les lignes concern√©es par exemple&#160;‚Äì pour constater les changements dans notre navigateur.</p>
</div>
<div class="listingblock">
<div class="title">livereload/react-app-hmr.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import { createElement } from 'react';
import ReactDOM from 'react-dom';
import ButtonCount from './button-count.jsx';

ReactDOM.render(
  createElement('div', {}, [
    createElement(ButtonCount),
    createElement(ButtonCount),
    // createElement(ButtonCount),
  ]),
  document.querySelector('#app')
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Chaque instance du composant <code>livereload/button-count.jsx</code> g√®re un √©tat interne
ind√©pendant des autres instances de m√™me type.
Nous aurions perdu cet √©tat interne en cas d&#8217;utilisation de <em>browser-sync</em>, sans
remplacement √† chaud&#160;:</p>
</div>
<div class="listingblock">
<div class="title">livereload/button-count.jsx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-jsx hljs" data-lang="jsx">import React, { Component } from 'react';

export default class ButtonCount extends Component {
  constructor(props) {
    super(props);

    this.handleClick = this.handleClick.bind(this);

    this.state = {
      clickCount: 0                                           <b class="conum">(1)</b>
    };
  }

  handleClick () {
    this.setState({ clickCount: this.state.clickCount + 1 }); <b class="conum">(2)</b>
  }

  render() {
    let style = {};
    // style = {
    //   fontFamily: 'monospace',
    //   fontWeight: 'bold',
    //   textTransform:' uppercase',
    // };

    return (&lt;button style={style} onClick={this.handleClick}&gt;
      Clics : {this.state.clickCount}
    &lt;/button&gt;);
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Initialisation du compteur de clics propre √† chaque instance de <code>ButtonCount</code>.</p>
</li>
<li>
<p>Incr√©mentation du compteur de clics en r√©action √† un clic sur le composant <code>ButtonCount</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Alternative</span> ud et browserify-hmr</div>
<div class="paragraph">
<p>Deux modules vont nous aider&#160;: <em>ud</em> (<span class="URL"><a href="https://npmjs.com/ud" class="bare">npmjs.com/ud</a></span>)
et <em>browserify-hmr</em> (<span class="URL"><a href="https://npmjs.com/browserify-hmr" class="bare">npmjs.com/browserify-hmr</a></span>), respectivement pour
d√©clarer des modules rempla√ßables et pour d√©marrer un serveur de remplacement
√† chaud minimaliste.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="node-sass">6.3. Modulariser ses feuilles de style avec&#160;Sass</h3>
<div class="paragraph">
<p>La modularit√© et l&#8217;√©criture d&#8217;un code isol√© facilitent sa r√©utilisation et
pr√©viennent les effets de bord.
Dans le cas des feuilles de style CSS, cela peut √©viter de faire
d√©border la cascade&#160;‚Äì si l&#8217;on peut&#160;dire.</p>
</div>
<div class="paragraph">
<p>Avec le langage Sass (<span class="URL"><a href="http://sass-lang.com" class="bare">sass-lang.com</a></span>), nous pourrions songer √†
g√©n√©rer des blocs de code selon des listes (id√©al pour des th√®mes de couleurs,
des rubriques produits, etc.), √† concevoir des composants comme des fonctions
ou √† b√©n√©ficier de fonctions de calcul de couleurs ou d&#8217;unit√©s de mesure.</p>
</div>
<div class="paragraph">
<p>Le langage Sass est originaire du monde Ruby, mais il a √©t√© depuis rendu
accessible nativement √† l&#8217;√©cosyst√®me Node par le biais de <em>node-sass</em>
(<span class="URL"><a href="https://npmjs.com/node-sass" class="bare">npmjs.com/node-sass</a></span>)‚Äì et, par extension,
par la biblioth√®que&#160;C <em>libsass</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Lecture</span> CSS maintenables avec Sass et Compass</div>
<div class="paragraph">
<p>Je recommande la lecture de l&#8217;ouvrage de r√©f√©rence
<em>CSS&#160;maintenables avec Sass et Compass</em>,
√©crit par Kaelig&#160;Deloumeau-Prigent aux √©ditions Eyrolles.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://editions-eyrolles.com/Livre/9782212136401" class="bare">editions-eyrolles.com/Livre/9782212136401</a></span></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il d√©crit tr√®s bien les tenants et aboutissants de Sass, ainsi que de bonnes
m√©thodes d&#8217;organisation du code et de maintenabilit√© au sein d&#8217;une √©quipe de
travail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>node-sass</em> offre un outil en ligne de commande pour compiler un fichier Sass,
plusieurs fichiers Sass ou encore une arborescence de r√©pertoires contenant des
fichiers Sass vers des fichiers CSS compr√©hensibles par les navigateurs.</p>
</div>
<div class="listingblock">
<div class="title">ui/buttons.scss</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sass hljs" data-lang="sass">$sizes: (                             <b class="conum">(1)</b>
  small: .8,
  regular: 1,
  large: 1.2
);

.btn {
  @each $size, $factor in $sizes {    <b class="conum">(2)</b>
    &amp;.btn--#{$size} {                 <b class="conum">(3)</b>
      font-size: $factor * 1em;       <b class="conum">(4)</b>
    }
  }

  &amp;.btn--icon {                       <b class="conum">(5)</b>
    svg {
      height: 16px;
      width: 16px;
      margin-right: .5em;
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>D√©finition d&#8217;une <code>Map</code> nomm√©e <code>$sizes</code> (ensemble cl√©/valeur) d√©crivant des tailles et leur facteur multiplicateur.</p>
</li>
<li>
<p>It√©ration et extraction des cl√©s/valeurs de <code>$sizes</code>.</p>
</li>
<li>
<p>Interpolation d&#8217;une variable pour composer un s√©lecteur CSS (<code>.btn&#8212;&#8203;small</code>, <code>.btn&#8212;&#8203;regular</code> etc.).</p>
</li>
<li>
<p>Calcul de la taille de la police de caract√®res (<code>.8em</code>, <code>1em</code>, etc.).</p>
</li>
<li>
<p>Composition d&#8217;un s√©lecteur de classe √† partir du s√©lecteur courant (<code>.btn.btn&#8212;&#8203;icon</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>La compilation des fichiers s&#8217;effectue tr√®s simplement&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/node-sass -o ./examples ./examples/buttons.scss</pre>
</div>
</div>
<div class="paragraph">
<p>Elle produit le fichier CSS <code>button.css</code>, lisible par tout navigateur&#160;:</p>
</div>
<div class="listingblock">
<div class="title">ui/buttons.css</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">.btn.btn--small {
  font-size: 0.8em; }

.btn.btn--regular {
  font-size: 1em; }

.btn.btn--large {
  font-size: 1.2em; }

.btn.btn--icon svg {
  height: 16px;
  width: 16px;
  margin-right: .5em; }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Astuce</span> Oublions les <em>vendor prefix</em></div>
<div class="paragraph">
<p>Les navigateurs √©voluent plus vite que le cycle de vie de nos projets.
Certaines propri√©t√©s CSS sont abrit√©es derri√®re des pr√©fixes (<code>-moz</code>, <code>-webkit</code>,
etc.) avant d&#8217;√™tre standardis√©es.</p>
</div>
<div class="paragraph">
<p>Les modules <em>autoprefixer</em> (<span class="URL"><a href="https://npmjs.com/autoprefixer" class="bare">npmjs.com/autoprefixer</a></span>) et
<em>postcss</em> (<span class="URL"><a href="https://npmjs.com/postcss" class="bare">npmjs.com/postcss</a></span>) facilitent notre vie en pr√©fixant
et r√©√©crivant automatiquement les attributs en fonction de nos exigences de
compatibilit√© avec les navigateurs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ui-bundling">6.4. Lier composants visuels et feuilles de&#160;style</h3>
<div class="paragraph">
<p>Souvenons-nous de la section expliquant le
<a href="#react">rapprochement entre donn√©es, rendu et interactions avec React</a>.
Finalement, nous avons presque tout rapproch√©, exception faite de la pr√©sentation
avec Sass ou CSS.</p>
</div>
<div class="paragraph">
<p>En suivant la logique de notre approche modulaire, nous pourrions imaginer
un <em>transform browserify</em> pour compiler et/ou extraire notre code Sass ou
CSS depuis nos modules CommonJS ou ECMAScript.</p>
</div>
<div class="paragraph">
<p>C&#8217;est exactement la proposition du module <em>sassify</em>.
Il int√®gre <em>node-sass</em> en tant que <em>transform browserify</em> et transforme le
code √† la vol√©e durant la phase de compilation.
Il se charge lui-m√™me d&#8217;ajouter les styles dans le document HTML ou expose le
code CSS compil√© via la fonction <code>require()</code>.</p>
</div>
<div class="paragraph">
<p>Une saine strat√©gie serait de charger des CSS de base dans une feuille de style
en t√™te de <code>&lt;head&gt;</code> puis de laisser les composants graphiques injecter leurs
feuilles CSS respectives apr√®s coup.</p>
</div>
<div class="paragraph">
<p>L&#8217;exemple suivant expose deux composants <em>React</em>, regroup√©s dans une th√©matique
de composants de boutons HTML.
Une feuille de style est import√©e √† m√™me le module afin de g√©rer √† un m√™me niveau
pr√©sentation, rendu et interactions&#160;:</p>
</div>
<div class="listingblock">
<div class="title">ui/Buttons.jsx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-jsx hljs" data-lang="jsx">import React from 'react';
import './buttons.scss';          <b class="conum">(1)</b>

const Icon = (props) =&gt; (&lt;svg aria-hidden="true"&gt;
  &lt;use xlinkHref={'symbols.svg#' + props.id} /&gt;
&lt;/svg&gt;);

export const BaseButton = (props) =&gt; (
  &lt;button className={'btn btn--' + props.variant}&gt;{props.children}&lt;/button&gt;
);

export const IconButton = (props) =&gt; (
  &lt;button className="btn btn--icon"&gt;
    &lt;Icon id={props.icon} /&gt;
    {props.children}
  &lt;/button&gt;
);</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Import d&#8217;un fichier Sass qui sera par la suite compil√© en CSS par le <em>transform sassify</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Sans surprise, le module <em>sassify</em> se charge comme la majorit√© des
<em>transforms browserify</em> comme vu dans la section
&#8220;<a href="#browserify">Importer des modules&#160;<code>npm</code> pour le Web</a>&#8221; dans ce m√™me chapitre&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/browserify \
  -t sassify \
  -t babelify \
  -e ./examples/Buttons.jsx \
  -o ./examples/Button-browserify.js</pre>
</div>
</div>
<div class="paragraph">
<p>La commande suivante injectera automatiquement les feuilles de style compil√©es
dans le document HTML lors de son ex√©cution dans un navigateur&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/browserify \
  -t [ sassify --auto-inject ] \
  -t babelify \
  -e ./examples/Buttons.jsx \
  -o ./examples/Button-browserify.js</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="optimiser_ses_ressources_graphiques">6.5. Optimiser ses ressources graphiques</h3>
<div class="paragraph">
<p>Node est un outil de choix lorsque l&#8217;on souhaite s&#8217;atteler au d√©veloppement
<em>front-end</em> et ce n&#8217;est pas sans raison.
Outre l&#8217;outillage li√© √† la r√©√©criture du code, il regorge de modules&#160;<code>npm</code>
r√©duisant les t√¢ches manuelles r√©p√©titives et possiblement sujettes √† erreur.</p>
</div>
<div class="paragraph">
<p>Nous retrouvons l&#8217;optimisation des ressources graphiques parmi cet ensemble de
t√¢ches r√©barbatives.
Quand j&#8217;√©cris ressources graphiques, j&#8217;entends par l√† le redimensionnement ou
la cr√©ation de vignettes d&#8217;images, l&#8217;optimisation de leur poids, la fusion de
fichiers&#160;SVG sous forme de symboles, la cr√©ation de piles de
polices de caract√®res et m√™me l&#8217;encodage audio/vid√©o&#160;‚Äì via des logiciels
sp√©cialis√©s comme <em>ffmpeg</em> ou <em>lame</em>.</p>
</div>
<div class="paragraph">
<p>L&#8217;outil en ligne de commande <em>imagemin-cli</em> (<span class="URL"><a href="https://npmjs.com/imagemin-cli" class="bare">npmjs.com/imagemin-cli</a></span>)
est le module de r√©f√©rence pour optimiser les fichiers graphiques.
Il est bas√© sur la biblioth√®que <em>imagemin</em> (<span class="URL"><a href="https://npmjs.com/imagemin" class="bare">npmjs.com/imagemin</a></span>) et
se charge de r√©duire le poids de nos images JPEG, PNG mais aussi GIF (anim√©s
et statiques) ainsi que le format vectoriel&#160;SVG.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/imagemin images/* --out-dir images
8 images minified</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Glossaire</span> Compression destructive et non&#160;destructive</div>
<div class="paragraph">
<p>Il existe deux types de compression&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>destructive&#160;: poids r√©duit au maximum, possibles artefacts visuels, destruction
potentielle de couleurs dans le cas d&#8217;images complexes&#160;;</p>
</li>
<li>
<p>sans perte&#160;: poids r√©duit, les couleurs supprim√©es ne sont pas perceptibles
√† l&#8217;≈ìil&#160;nu.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il vaut mieux privil√©gier la <em>compression sans perte</em> pour √©viter les artefacts
visuels et respecter fid√®lement la cr√©ation d&#8217;origine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le redimensionnement d&#8217;images est une autre de ces t√¢ches courantes et r√©currentes
qui tombe rapidement aux oubliettes de par sa gourmandise en temps.
On voudra par exemple redimensionner des photos depuis des fichiers originaux,
g√©n√©rer des vignettes ou encore diff√©rentes tailles d&#8217;image adapt√©es
aux diff√©rentes dispositions d&#8217;un site web <em>responsive</em>.</p>
</div>
<div class="paragraph">
<p><em>sharp-cli</em> (<span class="URL"><a href="https://npmjs.com/sharp-cli" class="bare">npmjs.com/sharp-cli</a></span>) r√©pond exactement √† ce cahier
des charges.
Ce module en ligne de commande est bas√© sur <em>sharp</em> (<span class="URL"><a href="https://npmjs.com/sharp" class="bare">npmjs.com/sharp</a></span>),
une biblioth√®que Node de modification d&#8217;images √©crite en ECMAScript et <em>C++</em>.
<em>sharp</em> nous aidera entre autres √† redimensionner, d√©couper, retourner, recentrer,
assembler et appliquer des effets graphiques de mani√®re pr√©dictible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/sharp resize 500 \
  --min \
  -i images/*.png \
  --output ./images/thumbs</pre>
</div>
</div>
<div class="paragraph">
<p>La commande pr√©c√©dente illustre une op√©ration de redimensionnement d&#8217;images&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>d&#8217;une dimension de 500 pixels de largeur&#160;;</p>
</li>
<li>
<p>minimum, pour respecter les proportions initiales&#160;‚Äì sans cet attribut les images seraient des carr√©s
de 500 pixels de large et de haut&#160;;</p>
</li>
<li>
<p>ciblant toutes les images PNG du r√©pertoire <code>images</code>&#160;;</p>
</li>
<li>
<p>puis export√©es dans le r√©pertoire <code>images/thumbs</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/sharp grayscale \
  -i images/*.png \
  --output ./images/square</pre>
</div>
</div>
<div class="paragraph">
<p>√Ä l&#8217;inverse, cette commande illustre la conversion en noir et blanc
d&#8217;images ainsi que leur export dans un r√©pertoire diff√©rent.</p>
</div>
<div class="paragraph">
<p>L&#8217;interface en ligne de commande de <em>sharp-cli</em> ne permet pas de cr√©er
des op√©rations composites (redimensionner et convertir en niveaux de gris par exemple).
Il faudra recourir √† l&#8217;API Node de <em>sharp</em> et cha√Æner les op√©rations en
s&#8217;aidant des exemples document√©s sur <span class="URL"><a href="http://sharp.dimens.io" class="bare">sharp.dimens.io</a></span>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Alternative</span> gm</div>
<div class="paragraph">
<p><em>gm</em>&#160;(<span class="URL"><a href="https://npmjs.com/gm" class="bare">npmjs.com/gm</a></span>) est le module classique de
redimensionnement dans l&#8217;√©cosyst√®me Node.
Il s&#8217;interface avec les programmes <em>GraphicsMagick</em> et <em>ImageMagick</em>&#160;‚Äì
et n√©cessite donc leur pr√©sence sur le syst√®me d&#8217;exploitation.</p>
</div>
<div class="paragraph">
<p>Cela rend l&#8217;utilisation de <em>gm</em> l√©g√®rement moins triviale que celle de <em>sharp</em>
mais la quantit√© de ressources et la qualit√© du module en font une bonne
alternative √† consid√©rer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>L&#8217;utilisation d&#8217;un <a href="../chapter-05/index.html#npm-scripts">script&#160;<code>npm</code></a>
(<a href="../chapter-05/index.html">chapitre&#160;5</a>) est id√©ale pour d√©crire les
diff√©rentes actions d&#8217;optimisation.
Les scripts sont alors √† invoquer manuellement, sur un crochet Git
(<em>git&#160;hook</em>) ou automatiquement lors du d√©ploiement avec un
<a href="../chapter-06/index.html#deploy.ci">service d&#8217;int√©gration continue</a>, par
exemple.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing">7. Tester son code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>C&#8217;est bien connu que &#8220;lorsqu&#8217;on produit du code de qualit√©, √©crire des tests est amplement superflu et ne sert qu&#8217;√† nous ralentir&#8221;.</p>
</div>
<div class="paragraph">
<p>La r√©alit√© est toute autre et suit un paradigme tr√®s simple&#160;:
<strong>plus il y a de lignes de code, plus il y a de risques de commettre des erreurs</strong>.
Cela vaut aussi bien pour du HTML que du CSS ou encore de l&#8217;ECMAScript.</p>
</div>
<div class="paragraph">
<p>Cette derni√®re section de ce chapitre nous aidera √† comprendre
quoi et comment tester pour diminuer le co√ªt de maintenance de nos applications.</p>
</div>
<div class="sect2">
<h3 id="testing-101">7.1. Que tester ?</h3>
<div class="paragraph">
<p>L&#8217;id√©e d&#8217;√©crire des tests pour am√©liorer la qualit√© de son code est attrayante,
mais quand on ne sait pas quoi tester et ni √† qui demander pour se lancer,
il est √©vident qu&#8217;on ne va pas s&#8217;y mettre pour s&#8217;assurer que 1+1 valent bien 2.</p>
</div>
<div class="paragraph">
<p>Je pense √† ces trois r√®gles lorsque je souhaite √©crire des tests&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Qu&#8217;est-ce qui est public/export√©&#160;?</p>
</li>
<li>
<p>Qu&#8217;est-ce qui cr√©e des branches dans mon code&#160;?</p>
</li>
<li>
<p>Qu&#8217;est-ce qui vient du monde ext√©rieur&#160;?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La syntaxe de modules ECMAScript est id√©ale pour visualiser les segments
de code qui sont export√©s par nos diff√©rents fichiers.
√âl√©ment marquant&#160;: ce code est simple et devrait arriver √† compter le nombre
de mots mais nous n&#8217;avons aucune id√©e s&#8217;il fera correctement le travail sans
l&#8217;ex√©cuter dans une application.</p>
</div>
<div class="listingblock">
<div class="title">test-export.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const isString = (thing) =&gt; typeof thing === 'string';

const isWord = (word) =&gt; {
  return isString(word) &amp;&amp; /^[\w\s.,\-?!;+]{2,}$/.test(word);
};

export default function countWords (sentence) { <b class="conum">(1)</b>
  return sentence.split(' ').filter(isWord).length;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La fonction <code>countWords</code> est le seul √©l√©ment export√© par notre module et devrait donc √™tre le seul sujet de nos&#160;tests.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Une branche est une portion de code qui s&#8217;ex√©cute de mani√®re ponctuelle.
Ces sections de code s&#8217;activent ou non selon l&#8217;√©tat d&#8217;une structure de donn√©es.
Il faut pr√©voir au moins autant de tests que de branches pour valider les
attentes.</p>
</div>
<div class="listingblock">
<div class="title">test-branches.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">export default function isOdd (number) {
  if (!Number.isFinite(number)) {                     <b class="conum">(1)</b>
    throw new Error('number devrait √™tre un nombre');
  }

  if (number % 2) { <b class="conum">(2)</b>
    return true;
  }
  else {            <b class="conum">(3)</b>
    return false;
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Premi√®re branche activ√©e dans deux cas de figure.</p>
</li>
<li>
<p>Seconde branche.</p>
</li>
<li>
<p>Troisi√®me branche.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Enfin, l&#8217;acc√®s √† toute donn√©e externe est susceptible de mal fonctionner
sans que nous puissions ma√Ætriser l&#8217;origine des probl√®mes.
En revanche, l&#8217;√©criture de tests nous aidera √† accepter ce cas de figure et
√† le signaler √† nos applications.</p>
</div>
<div class="listingblock">
<div class="title">test-outside-world.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">export default function getLinkElementContent (linkElement) {
  const {href} = linkElement;           <b class="conum">(1)</b>

  return fetch(href)                    <b class="conum">(2)</b>
    .then(response =&gt; response.json())  <b class="conum">(3)</b>
    .then(pkg =&gt; pkg.dependencies);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>linkElement</code> peut ne pas √™tre un lien hypertexte (<code>document.querySelector</code> retourne&#160;<code>null</code>).</p>
</li>
<li>
<p>Ici, tout peut arriver&#160;: <code>href</code> n&#8217;est pas une URL valide (balise <code>href</code> vide), serveur indisponible, etc.</p>
</li>
<li>
<p>Et l√†, le fichier JSON peut √™tre mal form√© ou la r√©ponse est exprim√©e dans un autre format que&#160;JSON.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous savons d√©sormais √† peu pr√®s tout ce qu&#8217;il faut suspecter pour renforcer
nos applications en √©crivant quelques tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="soutiller_pour_√©crire_des_assertions">7.2. S&#8217;outiller pour √©crire des assertions</h3>
<div class="paragraph">
<p>Avant de nous lancer directement dans la conception et l&#8217;√©criture des tests,
int√©ressons-nous √† comprendre comment l&#8217;outillage se structure.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Assertion*</dt>
<dd>
<p>C&#8217;est la v√©rification d&#8217;une v√©rit√©, d&#8217;une attente, du r√©sultat d&#8217;une op√©ration.
Une assertion couvre une branche de&#160;code.</p>
</dd>
<dt class="hdlist1">Test</dt>
<dd>
<p>C&#8217;est un regroupement d&#8217;assertions couvrant toutes les branches des
fonctionnalit√©s publiques de notre&#160;code.</p>
</dd>
<dt class="hdlist1">Suite de tests</dt>
<dd>
<p>C&#8217;est un ensemble de tests couvrant un aspect logique d&#8217;un code applicatif.
Une application peut comporter plusieurs suites selon sa complexit√©&#160;:
tests <strong>unitaires</strong> (interface de code),
tests <strong>fonctionnels</strong> (sc√©narios d&#8217;utilisation d&#8217;une application),
tests d'<strong>int√©gration</strong> (d√©pendance vis √† vis d&#8217;autres applications et services).</p>
</dd>
<dt class="hdlist1">Ex√©cuteur de tests</dt>
<dd>
<p>C&#8217;est le logiciel responsable de cr√©er l&#8217;environnement d&#8217;ex√©cution d&#8217;une suite de tests.
Il exprime une opinion sur la structuration des tests ainsi que sur des
automatismes √† fournir pour acc√©l√©rer l&#8217;√©criture des&#160;tests.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>L&#8217;outillage varie selon chacun de ces niveaux.
Certains outils offrent une √©criture d&#8217;assertion plus fluide, d&#8217;autres proposent une √©criture plus sp√©cifiquement adapt√©e.</p>
</div>
<div class="paragraph">
<p>Les sections suivantes sont compl√©mentaires.
J&#8217;ai favoris√© des approches it√©ratives et modulaires pour faciliter l&#8217;ajout ou le retrait de tout outil de notre outillage&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la biblioth√®que <em>chai</em> pour les assertions&#160;;</p>
</li>
<li>
<p>la biblioth√®que <em>mocha</em> pour les tests&#160;;</p>
</li>
<li>
<p>la biblioth√®que <em>mocha</em> pour la suite de tests ex√©cutable par&#160;Node&#160;;</p>
</li>
<li>
<p>l&#8217;ex√©cuteur de tests nomm√©  <em>karma</em> pour faire fonctionner la suite de tests
dans les navigateurs.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> chai, mocha et karma</div>
<div class="paragraph">
<p>Ces trois biblioth√®ques disposent d&#8217;une documentation en ligne expliquant leurs
options respectives, ainsi que des exemples d&#8217;utilisation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>chai</em>&#160;: <span class="URL"><a href="http://chaijs.com/api/bdd/" class="bare">chaijs.com/api/bdd/</a></span>&#160;;</p>
</li>
<li>
<p><em>mocha</em>&#160;: <span class="URL"><a href="https://mochajs.org" class="bare">mochajs.org</a></span>&#160;;</p>
</li>
<li>
<p><em>karma</em>&#160;: <span class="URL"><a href="https://karma-runner.github.io" class="bare">karma-runner.github.io</a></span>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock interactive interactive--javascript interactive--runtime--node-v10">
<div class="title">Exemple d&#8217;assertion avec la biblioth√®que&#160;chai</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import {expect} from 'chai';

expect(2+2).to.equal(4);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Exemple de test avec la biblioth√®que <em>mocha</em></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">describe('functionName', () =&gt; {
  it('should succeed with parameter cheese', () =&gt; {
    // ...
  });

  it('should throw an error with parameter meat', () =&gt; {
    // ...
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Exemple d&#8217;ex√©cution de suites de tests avec mocha et karma</div>
<div class="content">
<pre><span data-bash-subs="$"></span>mocha tests/**/*.js
<span data-bash-subs="$"></span>karma start</pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;ex√©cuteur de tests <em>karma</em> se configure par le biais d&#8217;un fichier <code>karma.conf.js</code>.
Nous en trouverons un √† la racine du r√©pertoire des ressources du
<a href="../chapter-04/index.html">chapitre&#160;4</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tester_ses_composants_react_sans_navigateur">7.3. Tester ses composants React sans navigateur</h3>
<div class="paragraph">
<p>Un des points forts de <a href="#react">React</a> √©voqu√©s dans ce chapitre est la
description de son rendu √† m√™me le composant.
Nous b√©n√©ficions ainsi du r√©sultat final (son HTML par exemple) ainsi que d&#8217;un
arbre repr√©sentant une structure de sous-√©l√©ments et de propri√©t√©s.</p>
</div>
<div class="paragraph">
<p>Nous disposons de deux strat√©gies pour tester les diff√©rents comportements d&#8217;un
composant <em>React</em>&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tester le rendu en comparant des cha√Ænes de caract√®res&#160;;</p>
</li>
<li>
<p>tester l&#8217;√©tat en validant la pr√©sence d&#8217;attributs ou le d√©clenchement de
certaines m√©thodes du composant.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La biblioth√®que <em>Enzyme</em> (<span class="URL"><a href="https://npmjs.com/enzyme" class="bare">npmjs.com/enzyme</a></span>) s&#8217;occupe tr√®s bien des
deux, en plus de s&#8217;int√©grer avec n&#8217;importe quelle biblioth√®que de tests.
Dans tous les cas, elle nous permettra de monter nos composants, soit de mani√®re
isol√©e, soit dans un v√©ritable arbre DOM, soit en rendu&#160;HTML.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> <em>Enzyme</em></div>
<div class="paragraph">
<p>L&#8217;√©quipe d&#8217;Airbnb offre une documentation exhaustive sur <span class="URL"><a href="http://airbnb.io/enzyme/" class="bare">airbnb.io/enzyme/</a></span>.
J&#8217;ai beaucoup appr√©ci√© les exemples complets d&#8217;int√©gration avec
<em>mocha</em>, <em>webpack</em> et&#160;<em>tape</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous allons nous baser sur le composant cr√©√© dans la section
&#8220;<a href="#react">Rapprocher donn√©es, rendu et interactions avec React</a>&#8221; pour s&#8217;assurer
de son comportement avant m√™me de l&#8217;inclure dans notre application.</p>
</div>
<div class="listingblock">
<div class="title">tests/date-interval.js (configuration)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import { createElement } from 'react';
import { expect } from 'chai';
import { shallow } from 'enzyme';
import DateInterval from '../modules/date-interval.jsx';<b class="conum">(1)</b>

describe('&lt;DateInterval /&gt;', () =&gt; {
  // ... (tests)
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Import du module <code>DateInterval</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notre premier test consiste √† v√©rifier que notre composant React g√©n√®re
bien une balise <code>&lt;time&gt;</code> en sortie.</p>
</div>
<div class="listingblock">
<div class="title">tests/date-interval.js (tests)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// (configuration)
describe('&lt;DateInterval /&gt;', () =&gt; {
  const element = createElement(DateInterval);

  it('affiche un √©l√©ment &lt;time&gt;', () =&gt; {               <b class="conum">(1)</b>
    const component = shallow(element);                 <b class="conum">(2)</b>

    expect(component.find('time')).to.have.length(1);   <b class="conum">(3)</b>
  });
  // ...
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©ation d&#8217;un test destin√© √† v√©rifier la nature de la balise HTML √† g√©n√©rer.</p>
</li>
<li>
<p>Cr√©ation du composant isol√© (<em>shallow</em>)&#160;‚Äì aucun √©l√©ment DOM ne sera cr√©√© ni ins√©r√© dans le document.</p>
</li>
<li>
<p>On √©crit une assertion garantissant que l&#8217;on retourne un √©l√©ment <code>&lt;time&gt;</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le deuxi√®me aspect √† tester concerne les donn√©es du composant, et leur effet
sur la valeur de classe de l&#8217;√©l√©ment HTML g√©n√©r√© en sortie.</p>
</div>
<div class="listingblock">
<div class="title">tests/date-interval.js (tests, suite)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// (configuration)
describe('&lt;DateInterval /&gt;', () =&gt; {
  const element = createElement(DateInterval);
  // ...
  it('la propri√©t√© tickDate influence la classe HTML', () =&gt; {
    const OK_CLASS = ['pair', 'impair'];
    const component = shallow(element);                 <b class="conum">(1)</b>
    const {tickData} = component.state();               <b class="conum">(2)</b>

    const time = tickData.now.getTime();
    expect(time).to.be.closeTo(Date.now(), 3);          <b class="conum">(3)</b>
    expect(tickData.className).to.be.oneOf(OK_CLASS);   <b class="conum">(4)</b>
  });
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©ation d&#8217;un second composant isol√© dont l&#8217;√©tat est ind√©pendant du premier.</p>
</li>
<li>
<p>R√©cup√©ration de l&#8217;√©tat (<em>state</em>) du composant.</p>
</li>
<li>
<p>Assertion v√©rifiant que la date utilis√©e par le composant est proche de la date courante (√† quelques millisecondes&#160;pr√®s).</p>
</li>
<li>
<p>Assertion v√©rifiant qu&#8217;une propri√©t√© de l&#8217;√©tat ne peut √™tre qu&#8217;une des deux valeurs parmi <code>pair</code> et <code>impair</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>En compl√©ment, la biblioth√®que <em>chai-enzyme</em> (<span class="URL"><a href="https://npmjs.com/chai-enzyme" class="bare">npmjs.com/chai-enzyme</a></span>)
√©tend le vocabulaire de <em>chai</em> pour ajouter des assertions de composants.
C&#8217;est une question de go√ªt plus qu&#8217;une n√©cessit√©.<br>
L&#8217;exemple suivant reprend le composant cr√©√© dans la section
&#8220;<a href="#livereload">Changements en temps&#160;r√©el dans le navigateur</a>&#8221; et illustre une
assertion suite √† un clic sur le bouton&#160;:</p>
</div>
<div class="listingblock">
<div class="title">tests/button-count.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import React from 'react';
import chai, { expect } from 'chai';
import chaiEnzyme from 'chai-enzyme';
import { shallow } from 'enzyme';
import ButtonCount from '../livereload/button-count.jsx';

chai.use(chaiEnzyme());

describe('&lt;ButtonCount /&gt;', () =&gt; {
  it('should increment state on click', () =&gt; {       <b class="conum">(1)</b>
    const component = shallow(&lt;ButtonCount /&gt;);
    component.simulate('click');                      <b class="conum">(2)</b>

    expect(component).to.have.state('clickCount', 1); <b class="conum">(3)</b>
  });
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le libell√© du test d√©crit le r√©sultat attendu dans les assertions.</p>
</li>
<li>
<p>Simulation du clic sur le composant.</p>
</li>
<li>
<p>L&#8217;√©tat interne a bien √©t√© chang√© et correspond √† la valeur attendue.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le fichier <code>package.json</code> des ressources de ce chapitre
contient une t√¢che ex√©cutant les tests ex√©cutables dans un environnement Node uniquement.
Elle se lance de la mani√®re suivante&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>npm run test:node</pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/mocha-react.png" alt="mocha react" width="80%">
</div>
<div class="title">Figure 8. Extrait de la sortie de la commande npm&#160;run&#160;test:node</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Alternative</span> <em>jest</em></div>
<div class="paragraph">
<p><em>jest</em> (<span class="URL"><a href="https://npmjs.com/jest" class="bare">npmjs.com/jest</a></span>) est un ex√©cuteur de tests moderne et
rapide particuli√®rement adapt√© au test de composants c√¥t√© serveur.
Au moment d&#8217;√©crire cet ouvrage, il n&#8217;√©tait pas encore possible de l&#8217;ex√©cuter
dans un navigateur.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il est int√©ressant de retenir que les tests navigateurs ne sont pas indispensables
pour s&#8217;assurer du bon fonctionnement de nos composants.
Des biblioth√®ques comme <em>React</em> sont d√©j√† solidement test√©es.
Cela nous laisse l&#8217;opportunit√© de nous concentrer uniquement sur notre logique m√©tier.</p>
</div>
<div class="paragraph">
<p>Les tests navigateurs sont en revanche utiles pour tester la compatibilit√©
navigateurs, que ce soit au niveau de la syntaxe ECMAScript ou du rendu&#160;CSS.</p>
</div>
</div>
<div class="sect2">
<h3 id="tester_code_et_composants_dans_les_navigateurs">7.4. Tester code et composants dans les navigateurs</h3>
<div class="paragraph">
<p>C&#8217;est bien beau de tester uniquement l&#8217;interface de composants <em>React</em>
(ou autre technologie) mais comment faire lorsqu&#8217;on a besoin de tester avec un
vrai DOM ou dans plusieurs navigateurs&#160;?</p>
</div>
<div class="paragraph">
<p>On a besoin de tester dans des navigateurs pour&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>s&#8217;assurer de la compatibilit√© de notre code avec les variations d&#8217;impl√©mentation de navigateurs&#160;;</p>
</li>
<li>
<p>valider notre choix de <em>polyfills</em>&#160;;</p>
</li>
<li>
<p>tester fid√®lement contre des API de navigateurs ou du DOM (comme <em>Web&#160;Audio</em> ou
<em>Service&#160;Workers</em>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Autrement dit, nous avons besoin d&#8217;un ex√©cuteur de tests qui les fasse fonctionner
dans l&#8217;environnement d&#8217;un navigateur.
Id√©alement, nous voulons que cet ex√©cuteur de tests n&#8217;influe pas sur l&#8217;outillage
employ√© pour √©crire nos tests et donc nous permette d&#8217;utiliser <em>mocha</em> et <em>chai</em>
comme dans la section pr√©c√©dente.</p>
</div>
<div class="paragraph">
<p><em>karma</em> (<span class="URL"><a href="https://npmjs.com/karma" class="bare">npmjs.com/karma</a></span>) est l&#8217;outil phare de l&#8217;√©cosyst√®me
Node d√©di√© aux tests dans les navigateurs.
Il a √©t√© cr√©√© en&#160;2012 pour faciliter l&#8217;ex√©cution des suites de tests de la
biblioth√®que <em>Angular</em> et s&#8217;ex√©cute en ligne de commande.</p>
</div>
<div class="paragraph">
<p>Les fonctionnalit√©s de <em>karma</em> s&#8217;√©tendent √† l&#8217;aide de modules&#160;<code>npm</code>&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>int√©grations avec des suites de tests&#160;;</p>
</li>
<li>
<p>lanceurs de navigateurs&#160;;</p>
</li>
<li>
<p>pr√©processeurs pour transformer des fichiers, les servir et/ou les inclure
dans l&#8217;environnement de tests.</p>
</li>
</ul>
</div>
<div class="videoblock">
<div class="title">Exemple de tests multi-navigateurs en continu avec <em>karma</em></div>
<div class="content">
<video src="./videos/karma-browsers.mp4" width="70%" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>Le pilotage de <em>karma</em> se fait via un fichier de configuration <code>karma.conf.js</code>.
Il est possible de surcharger ult√©rieurement cette configuration avec des
arguments de la ligne de commande.</p>
</div>
<div class="listingblock">
<div class="title">Initialisation automatique d&#8217;un fichier de configuration <code>karma.conf.js</code></div>
<div class="content">
<pre><span data-bash-subs="$"></span>./node_modules/.bin/karma init</pre>
</div>
</div>
<div class="paragraph">
<p><em>karma</em> fonctionne avec des navigateurs install√©s sur notre machine de
d√©veloppement tout comme avec des services distants comme <em>SauceLabs</em> ou
<em>BrowserStack</em> (voir &#8220;<a href="#ci">Int√©gration continue et compatibilit√© navigateurs</a>&#8221;).
Les navigateurs doivent d√©j√† √™tre disponibles sur la machine de test (Firefox
et Chrome par exemple) et nous devons en parall√®le installer les lanceurs
(<code>karma-firefox-launcher</code> et <code>karma-chrome-launcher</code> respectivement).</p>
</div>
<div class="paragraph">
<p>Les navigateurs lanc√©s par d√©faut lors des tests sont list√©s dans l&#8217;option <code>browsers</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="title">karma.conf.js#L49</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">autoWatch: true,</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>karma</em> se charge d&#8217;inclure les fichiers ECMAScript ou de servir des fichiers
statiques en fonction de motifs de chemins.
Ces fichiers peuvent √™tre locaux (de pr√©f√©rence) ou distants et m√™me de
types diff√©rents comme JSON ou&#160;HTML&#160;:</p>
</div>
<div class="listingblock">
<div class="title">karma.conf.js#L7-17</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">files: [
  //'https://cdn.polyfill.io/v2/polyfill.min.js',  <b class="conum">(1)</b>
  'examples/tests-browser/**/*.js',                <b class="conum">(2)</b>
  'examples/tests/**/*.js',
  'examples/tests-browser/**/*.html',              <b class="conum">(3)</b>
  {
    pattern: 'package.json',                       <b class="conum">(4)</b>
    served: true,
    included: false                                <b class="conum">(5)</b>
  }
],</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Il suffirait de d√©commenter cette ligne pour inclure les <a href="#polyfills"><em>polyfills</em> de navigateurs</a> sans toucher √† notre&#160;code.</p>
</li>
<li>
<p>Inclusion des fichiers de tests&#160;‚Äì ils sont appel√©s dans des balises HTML <code>&lt;script&gt;</code>.</p>
</li>
<li>
<p>Inclusion de fichiers HTML&#160;‚Äì ils sont accessibles via&#160;HTTP.</p>
</li>
<li>
<p>Mise √† disposition du fichier <code>package.json</code>&#160;‚Äì accessible via HTTP √† l&#8217;adresse <code>/base/package.json</code>.</p>
</li>
<li>
<p>Indique que ce fichier ne doit pas √™tre inclus dans une balise HTML <code>&lt;script&gt;</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Des int√©grations doivent √™tre d√©clar√©es pour augmenter les fonctionnalit√©s de
base de <em>karma</em>.
Ces derni√®res se r√©sument √† charger des fichiers ECMAScript
dans une balise <code>&lt;script&gt;</code>.</p>
</div>
<div class="paragraph">
<p>L&#8217;extrait de configuration suivant illustre le chargement des <em>plug-in</em> pour
<em>browserify</em> (modules <em>CommonJS</em> et transpilation), <em>mocha</em> (suites de tests)
et <em>fixture</em> (donn√©es repr√©sentant des cas d&#8217;utilisation)&#160;‚Äì respectivement
les modules <code>npm</code> <code>karma-browserify</code>, <code>karma-mocha</code> et <code>karma-fixture</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="title">karma.conf.js#L5</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">frameworks: ['browserify', 'mocha', 'fixture'],</code></pre>
</div>
</div>
<div class="paragraph">
<p>Une fois encore, des motifs de chemins sont utilis√©s pour indiquer aux <em>plug-in</em>
leur responsabilit√© de prise en charge.</p>
</div>
<div class="listingblock">
<div class="title">karma.conf.js#L21-25</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">preprocessors: {
  'examples/tests/**/*.js': ['browserify'],         <b class="conum">(1)</b>
  'examples/tests-browser/**/*.js': ['browserify'],
  'examples/tests-browser/**/*.html': ['html2js'],  <b class="conum">(2)</b>
},</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ces fichiers seront transpil√©s par <em>browserify</em> avant d&#8217;√™tre charg√©s dans les tests de navigateurs.</p>
</li>
<li>
<p>Ces fichiers seront pris en charge par le pr√©processeur nomm√© <em>html2js</em>, utilis√© par <code>karma-fixture</code> pour transformer du HTML en arbre&#160;DOM.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous avons vu un exemple de code reposant sur un √©l√©ment du DOM dans la section
&#8220;<a href="#testing-101">Que tester&#160;?</a>&#8221;.
Nous allons nous int√©resser √† une mani√®re possible de tester la fonction
export√©e <code>getLinkElementContent()</code> en se basant sur un v√©ritable appel HTTP et
un v√©ritable √©l√©ment du DOM, cr√©√© √† partir du fichier de <em>fixture</em> suivant&#160;:</p>
</div>
<div class="listingblock">
<div class="title">tests-browser/fixtures/link-package.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;a href="/base/package.json"&gt;Test&lt;/a&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce fichier de fixture est charg√© dans le DOM par le <em>plug-in</em> <code>karma-fixture</code>
pour prouver que l&#8217;on peut r√©cup√©rer les d√©pendances expos√©es par le fichier
<code>package.json</code> des ressources de ce chapitre&#160;:</p>
</div>
<div class="listingblock">
<div class="title">tests-browser/test-outside-world.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">import { expect } from 'chai';
import getLinkElementContent from '../test-outside-world.js';

describe('getLinkElementContent', () =&gt; {
  before(() =&gt; {
    fixture.setBase('examples/tests-browser/fixtures'); <b class="conum">(1)</b>
  });

  it('fetches dependencies from remote package.json', () =&gt; {
    const [link] = fixture.load('link-package.html');   <b class="conum">(2)</b>

    return getLinkElementContent(link).then(deps =&gt; {   <b class="conum">(3)</b>
      expect(deps).to.contain.all.keys(                 <b class="conum">(4)</b>
        '@babel/core', 'react', 'enzyme'
      );
    });
  });
});</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>before()</code> indique √† <em>mocha</em> d&#8217;ex√©cuter ce bloc de code avant tout&#160;test.</p>
</li>
<li>
<p>Appel du <em>plug-in</em> de fixture pour obtenir l&#8217;√©l√©ment du DOM n√©cessaire √† la fonction <code>getLinkElementContent</code>.</p>
</li>
<li>
<p>Appel r√©el de la fonction <code>getLinkElementContent</code>, r√©solu comme une <a href="../chapter-03/index.html#promise">promesse</a> et dont nous testons le r√©sultat √† la ligne suivante.</p>
</li>
<li>
<p>Assertion v√©rifiant que le r√©sultat contient bien les cl√©s de d√©pendances&#160;<code>npm</code> attendues&#160;‚Äì nous avons bien r√©cup√©r√© le bon fichier et le bon contenu&#160;!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;invocation de <em>karma</em> se fait en invoquant <code>./node_modules/.bin/karma start</code>.
Par mesure de simplicit√©, cette commande a √©t√© abstraite en tant que
<a href="../chapter-05/index.html#npm-scripts">script&#160;<code>npm</code></a>&#160;:</p>
</div>
<div class="listingblock">
<div class="title">Ex√©cution ponctuelle de <em>karma</em></div>
<div class="content">
<pre><span data-bash-subs="$"></span>npm run test:browser</pre>
</div>
</div>
<div class="paragraph">
<p>Les tests peuvent √™tre relanc√©s en continu&#160;‚Äì d√®s qu&#8217;un fichier change&#160;‚Äì en
d√©sactivant l&#8217;ex√©cution unique (<em>single run</em>).
C&#8217;est id√©al lorsque les tests sont √©crits en parall√®le de l&#8217;impl√©mentation du
code ou que des ajustements fr√©quents ont lieu en phase de d√©veloppement&#160;:</p>
</div>
<div class="listingblock">
<div class="title">Ex√©cution continue de <em>karma</em></div>
<div class="content">
<pre><span data-bash-subs="$"></span>npm run test:browser -- --no-single-run</pre>
</div>
</div>
<div class="paragraph">
<p>Comme tout processus de longue dur√©e, il s&#8217;interrompt √† l&#8217;aide de la combinaison
de touches <span class="keyseq"><kbd>CTRL</kbd>+<kbd>C</kbd></span>.</p>
</div>
<div class="paragraph">
<p>Nous en savons d√©sormais suffisamment pour tester dans les conditions des
navigateurs avec du code modulaire et r√©utilisable.
La question qui se pose d√©sormais est la suivante&#160;:
<strong>comment faire pour tester plusieurs versions d&#8217;un m√™me navigateur</strong>, pour
tester sur un syst√®me d&#8217;exploitation que l&#8217;on n&#8217;a pas ou encore plusieurs
terminaux mobiles de type <em>smartphone</em> ou tablette.</p>
</div>
</div>
<div class="sect2">
<h3 id="ci">7.5. Int√©gration continue et compatibilit√© navigateurs</h3>
<div class="paragraph">
<p>Deux cas de figure se pr√©sentent en compl√©ment de la section pr√©c√©dente&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la difficult√© d&#8217;acc√®s √† certaines combinaisons navigateur + syst√®me d&#8217;exploitation&#160;;</p>
</li>
<li>
<p>l&#8217;envie d&#8217;automatiser les tests de navigateurs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sous Windows, il nous sera difficile de tester Safari pour macOS.
Inversement, sous macOS, il nous sera difficile de tester
Internet&#160;Explorer ou Edge.
Que dire d&#8217;anciennes versions de navigateurs Android, dont la rapidit√© de
d√©veloppement et donc la compatibilit√© sont bien en-de√ß√† des versions de Chrome
pour ordinateur ou mobile&#160;?</p>
</div>
<div class="videoblock">
<div class="title">Exemple de tests multi-navigateurs en continu avec <em>karma</em> et <em>BrowserStack</em></div>
<div class="content">
<video src="./videos/karma-browserstack.mp4" width="70%" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="paragraph">
<p>L&#8217;√©cosyst√®me de modules&#160;<code>npm</code> li√©s √† <em>karma</em> s&#8217;est d√©j√† pench√© sur la question.
C&#8217;est le cas notamment du produit <em>BrowserStack</em> qui offre une int√©gration pour
d√©l√©guer l&#8217;ex√©cution des tests sur leur plate-forme commerciale.
Il s&#8217;agit du module <code>karma-browserstack-launcher</code>
(<span class="URL"><a href="https://npmjs.com/karma-browserstack-launcher" class="bare">npmjs.com/karma-browserstack-launcher</a></span>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> <em>BrowserStack</em></div>
<div class="paragraph">
<p>La documentation de <em>BrowserStack</em> (<span class="URL"><a href="https://www.browserstack.com/automate/node" class="bare">www.browserstack.com/automate/node</a></span>)
d√©crit les diff√©rents syst√®mes d&#8217;exploitation √† disposition ainsi que les
navigateurs compatibles, pour PC, Mac, iOS et Android.</p>
</div>
<div class="paragraph">
<p>L&#8217;int√©gration avec Node est √©galement document√©e au cas o√π vous souhaiteriez
effectuer des tests sans passer par <em>karma</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>BrowserStack</em> n&#8217;est pas un navigateur en soi, mais offre un acc√®s √† une multitude
de navigateurs.
Il faut donc cr√©er de nouvelles configurations dans la propri√©t√© <code>customLaunchers</code>.
L&#8217;extrait de configuration suivant illustre la cr√©ation d&#8217;un navigateur <em>Safari</em>
pour <em>iPhone&#160;4S</em> sous <em>iOS&#160;5.1</em>&#160;:</p>
</div>
<div class="listingblock">
<div class="title">karma.conf.js#L51-58</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">browsers: ['Chrome'],

customLaunchers: {
  iphone4: {
    base: 'BrowserStack',
    device: 'iPhone 4S',
    os: 'ios',
    os_version: '5.1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;utilisation de <em>BrowserStack</em> n√©cessite un compte et l&#8217;obtention d&#8217;une cl√©
d&#8217;API afin d&#8217;utiliser leur service.
Notre nom d&#8217;utilisateur et la cl√© d&#8217;API doivent √™tre renseign√©s en tant que
variables d&#8217;environnement pour √©tablir une connexion au service et d√©marrer
notre bon vieil iPhone&#160;4&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>export BROWSER_STACK_USERNAME=...
<span data-bash-subs="$"></span>export BROWSER_STACK_ACCESS_KEY=...
<span data-bash-subs="$"></span>npm run test:browser -- --browsers iphone4</pre>
</div>
</div>
<div class="paragraph">
<p><em>BrowserStack</em> est configurable plus finement selon nos besoins.
Le r√©glage suivant s&#8217;assure de faire transiter les donn√©es HTTP
(scripts, HTML) via la connexion s√©curis√©e entre notre ordinateur et
<em>BrowserStack</em>.
C&#8217;est un r√©glage utile en cas de proxy exigeant ou de
r√©glages de connexion √† Internet bien sp√©cifiques.</p>
</div>
<div class="listingblock">
<div class="title">karma.conf.js#L39-41</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">},

browserStack: {</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Alternative</span> Sauce&#160;Labs</div>
<div class="paragraph">
<p><em>Sauce&#160;Labs</em> (<span class="URL"><a href="https://saucelabs.com" class="bare">saucelabs.com</a></span>) est un concurrent de <em>BrowserStack</em>.
Il offre des fonctionnalit√©s similaires et est gratuit pour les projets <em>open source</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ind√©pendamment de <em>BrowserStack</em>, l&#8217;int√©gration continue est un m√©canisme
permettant l&#8217;ex√©cution automatique des tests, de mani√®re reproductible et
dans un environnement syst√©matiquement propre&#160;‚Äì sans trace d&#8217;ex√©cution d&#8217;un
pr√©c√©dent&#160;test.</p>
</div>
<div class="paragraph">
<p>Cela a deux avantages ind√©niables&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ex√©cuter les tests pour tout changement de code, peu importe qui en est l&#8217;auteur&#160;;</p>
</li>
<li>
<p>s&#8217;assurer de l&#8217;ex√©cution syst√©matique des tests&#160;;</p>
</li>
<li>
<p>mettre en commun la logique d&#8217;ex√©cution de tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On √©vite ainsi les <em>oublis</em> tout en enlevant le co√ªt de mise en place de
l&#8217;infrastructure de tests chez des personnes contribuant de mani√®re occasionnelle.
Cerise sur le g√¢teau, on pr√©vient en partie les r√©gressions&#160;‚Äì changements qui
cassent le fonctionnement attendu d&#8217;une fonctionnalit√©.</p>
</div>
<div class="paragraph">
<p>Le service <em>Travis&#160;CI</em> (<span class="URL"><a href="https://travis-ci.com" class="bare">travis-ci.com</a></span>) est un service
d&#8217;int√©gration continue (<em>Continuous Integration</em>, <em>CI</em>) parmi d&#8217;autres, mais
qui a √©t√© rendu populaire pour son int√©gration avec GitHub.
Il est gratuit pour les projets <em>open source</em>.</p>
</div>
<div class="paragraph">
<p>Un service d&#8217;int√©gration continue est configur√© pour d√©finir ce qui est
ex√©cut√© avant, pendant et apr√®s les tests.
Il a donc l&#8217;avantage de faciliter l&#8217;automatisation des tests de navigateurs
√† m√™me la machine virtuelle (<em>Virtual Machine</em>, <em>VM</em>) de test ou bien
vers des plates-formes comme <em>BrowserStack</em>.
Son m√©canisme de variables d&#8217;environnement crypt√©es nous √©vitera de donner
acc√®s √† notre compte au premier&#160;venu.</p>
</div>
<div class="paragraph">
<p>Un fichier de configuration minimal au format YAML est n√©cessaire.
Des services comme GitHub facilitent la connexion avec <em>Travis&#160;CI</em> et
d√©clenchent automatiquement l&#8217;ex√©cution des tests √† chaque <em>commit</em>
ou <em>pull&#160;request</em>.</p>
</div>
<div class="listingblock">
<div class="title">.travis.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">language: node_js              <span data-bash-conum="1"></span>
node_js: v10                   <span data-bash-conum="2"></span>

addons:
  firefox: latest              <span data-bash-conum="3"></span>

env:
- MOZ_HEADLESS=1                                       <span data-bash-conum="4"></span>
- BROWSER_STACK_USERNAME="$BROWSER_STACK_USERNAME"     <span data-bash-conum="5"></span>
- BROWSER_STACK_ACCESS_KEY="$BROWSER_STACK_ACCESS_KEY"

script: npm run test:browser -- --browsers Firefox</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Configuration de la&#160;VM pour utiliser&#160;Node.</p>
</li>
<li>
<p>Configuration de la&#160;VM pour utiliser la version la plus r√©cente de Node&#160;v10.</p>
</li>
<li>
<p>Installation de la derni√®re version stable de Firefox.</p>
</li>
<li>
<p>La variable d&#8217;environnement <code>MOZ_HEADLESS</code> indique √† Firefox de d√©marrer sans afficher d&#8217;interface graphique √† l&#8217;√©cran.</p>
</li>
<li>
<p>J&#8217;ai param√©tr√© la cl√© d&#8217;acc√®s √† <em>BrowserStack</em> dans les r√©glages de <a href="#travis-ci">Travis&#160;CI</a> (voir encadr√©).</p>
</li>
</ol>
</div>
<div id="travis-ci" class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Documentation</span> Travis&#160;CI</div>
<div class="paragraph">
<p>Des services comme <em>Travis&#160;CI</em> sont puissants et amplement configurable
pour de nombreux besoins&#160;‚Äì dont Node (<span class="URL"><a href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs/" class="bare">docs.travis-ci.com/user/languages/javascript-with-nodejs/</a></span>)&#160;‚Äì
et y&#160;compris pour se connecter √† des bases de donn√©es PostgreSQL ou MariaDB.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/travis-ci-encrypted-env.png" alt="travis ci encrypted env" width="85%">
</div>
<div class="title">Figure 9. √âcran de param√©trage des variables d&#8217;environnement secr√®tes sur Travis&#160;CI.</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">8. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous sommes d√©sormais en mesure d'<strong>ex√©cuter des tests unitaires</strong> impliquant
des <strong>navigateurs web</strong> sur notre machine, sur des <strong>services distants</strong> mais
√©galement de mani√®re automatique avec des services d'<strong>int√©gration continue</strong>
comme <em>Travis&#160;CI</em>.</p>
</div>
<div class="paragraph">
<p>Le recours aux modules&#160;<code>npm</code> combin√©s aux modules ECMAScript facilite
<strong>la conception et la maintenance de code testable et r√©utilisable</strong>.</p>
</div>
<div class="paragraph">
<p>Ces pratiques de modularisation&#160;‚Äì jusqu&#8217;au rendu interm√©diaire de <em>React</em>
‚Äì encouragent une <strong>rigueur ayant un effet positif</strong> sur la qualit√© de notre
code et notre confiance √† le d√©ployer en production.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Derni√®re mise √† jour 2018-10-19 12:44:00 Coordinated Universal Time
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>